<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>åˆ©ç”¨æœ¬åœ°æµè§ˆå™¨åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿›è¡Œè®¿é—®</title>
    <link href="/2023/12/22/%E5%88%A9%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE/"/>
    <url>/2023/12/22/%E5%88%A9%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE/</url>
    
    <content type="html"><![CDATA[<h1 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h1><p>åœ¨å¾ˆå¤šæƒ…å†µä¸‹å¯èƒ½éƒ½ä¼šå‡ºç°è¿™æ ·çš„åœºæ™¯ï¼šæˆ‘ä»¬æƒ³è¦åŸºäºä¸€ä¸ªè¿œç¨‹serverçš„ipæ¥å¯¹æŸäº›ç½‘é¡µè¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯æœåŠ¡å™¨é€šå¸¸æ˜¯æ²¡æœ‰GUIç«¯çš„ Linux ç³»ç»Ÿï¼š</p><ul><li>æœåŠ¡å™¨éœ€è¦ç‰¹æ®Šçš„ç½‘å…³ç™»å½•æ‰èƒ½å¤Ÿä¸Šç½‘ï¼Œéœ€è¦åœ¨æŒ‡å®šçš„å†…ç½‘ IP ä¸‹æ‰èƒ½è®¿é—®ç½‘å…³</li><li>æœåŠ¡å™¨éƒ¨ç½²åœ¨å†…ç½‘å†…ï¼Œéœ€è¦ä»å†…ç½‘è®¿é—®æŸäº›èµ„æº</li><li>åœ¨è™šæ‹Ÿæœº&#x2F;å®¹å™¨å†…éƒ¨ç½²äº†ä¸€å¥—é›†ç¾¤ï¼Œç»„ä»¶ï¼ˆä¾‹å¦‚ Hadoopï¼ŒSparkï¼‰çš„ WebUI å’Œç›‘æ§éœ€è¦ä»æŒ‡å®šçš„ç«¯å£è¿›è¡Œè®¿é—®ï¼Œç„¶è€Œç«¯å£å¤ªå¤šï¼Œå…¨éƒ¨æ˜ å°„å‡ºæ¥ä¸æ–¹ä¾¿</li></ul><p>è™½ç„¶å¯ä»¥åœ¨æœåŠ¡å™¨å®‰è£… GUI ååœ¨åˆ©ç”¨ remote desktop è¿›è¡Œè®¿é—®ï¼Œä½†æ˜¯è¿™æ ·å…¶å®ä¹Ÿæ˜¯æ¯”è¾ƒéº»çƒ¦çš„ï¼ŒåŒæ—¶ä¸€äº›GUIå¯èƒ½åœ¨äº‘æœåŠ¡å™¨ä¸Šçš„å®‰è£…æ˜¯ä¸è¢«å…è®¸çš„</p><p>æ‰€ä»¥æˆ‘ä»¬æƒ³è¦æ‰¾åˆ°ä¸€ä¸ªæ–¹æ³•ï¼Œèƒ½å¤Ÿåœ¨æœ¬åœ°æµè§ˆå™¨ä¸Šï¼ŒåŸºäºè¿œç¨‹æœåŠ¡å™¨çš„ IPï¼Œè¿›è¡Œç½‘é¡µè®¿é—®</p><p>ä¸€ä¸ªæ¯”è¾ƒå¿«æ·çš„æ–¹æ³•æ˜¯é…ç½® socks5 ä»£ç†</p><h1 id="é…ç½®"><a href="#é…ç½®" class="headerlink" title="é…ç½®"></a>é…ç½®</h1><p>é¦–å…ˆéœ€è¦ç”¨ ssh é…ç½®ä¸€ä¸ªç«¯å£è½¬å‘</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">ssh â€”D[Port] username@host <br><span class="hljs-comment"># å¦‚æœserverçš„ç™»å½•éœ€è¦æŒ‡å®šç«¯å£</span><br>ssh -D[port] username@host -p [LoginPort]<br></code></pre></td></tr></table></figure><p>ç„¶åå†åœ¨æµè§ˆå™¨ä¸­é…ç½® socks5 ä»£ç†</p><p><img src="/2023/12/22/%E5%88%A9%E7%94%A8%E6%9C%AC%E5%9C%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E5%9C%A8%E8%BF%9C%E7%A8%8B%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%B8%8A%E8%BF%9B%E8%A1%8C%E8%AE%BF%E9%97%AE/proxy.png" alt="proxy"></p><p>ä»£ç†åè®®é€‰æ‹© SOCKS5ï¼Œä»£ç†æœåŠ¡å™¨é€‰æ‹© localhostï¼Œç«¯å£é€‰æ‹©ä¹‹å‰ç«¯å£è½¬å‘é…ç½®çš„ <code>[Port]</code>ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç”¨äº†20000</p><p>åœ¨é…ç½®å¥½è¿™ä¸ªä»£ç†ä¹‹åå°±å¯ä»¥ä½¿ç”¨è¿™ä¸ªä»£ç†åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿›è¡Œä¸Šç½‘</p><div class="note note-info">            <p>Chrome æµè§ˆå™¨ç›®å‰æ— æ³•ç›´æ¥é…ç½® SOCKS5 ä»£ç†ï¼Œéœ€è¦ä¸‹è½½æ’ä»¶ <a href="https://chromewebstore.google.com/detail/proxy-switchyomega/padekgcemlokbadohgkifijomclgjgif">Proxy SwitchOmege</a><br>Firefox å¯ä»¥ç›´æ¥é…ç½®</p>          </div>]]></content>
    
    
    <categories>
      
      <category>ç¯å¢ƒé…ç½®</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>VS Code + Python å¼€å‘ QGIS æ’ä»¶ç¯å¢ƒé…ç½®æŒ‡å—</title>
    <link href="/2023/10/22/VS-Code-Python-%E5%BC%80%E5%8F%91-QGIS-%E6%8F%92%E4%BB%B6%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/"/>
    <url>/2023/10/22/VS-Code-Python-%E5%BC%80%E5%8F%91-QGIS-%E6%8F%92%E4%BB%B6%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE%E6%8C%87%E5%8D%97/</url>
    
    <content type="html"><![CDATA[<h1 id="å†™åœ¨å‰é¢"><a href="#å†™åœ¨å‰é¢" class="headerlink" title="å†™åœ¨å‰é¢"></a>å†™åœ¨å‰é¢</h1><div class="note note-info">            <p>æ•´ç¯‡æ•™ç¨‹ For Windowsï¼Œå¥½åƒMacæ²¡æœ‰è¿™ä¹ˆå¤šäº‹ã€‚å‰ä¸€æ®µå¼€å‘æ’ä»¶çš„æ—¶å€™ç»™åŒç»„çš„åŒå­¦å†™çš„é…ç½®æ–‡æ¡£ï¼Œæ°å¥½å‘ç°ä¸­æ–‡äº’è”ç½‘ä¸Šç›¸å…³çš„å†…å®¹æ¯”è¾ƒå°‘ï¼Œä¹Ÿä¸å¤ªç³»ç»Ÿï¼Œåšä¸€ä¸ªç³»ç»Ÿçš„æ•´ç†ã€‚</p>          </div><h1 id="QGIS-å®˜æ–¹Plugin-æ–‡æ¡£"><a href="#QGIS-å®˜æ–¹Plugin-æ–‡æ¡£" class="headerlink" title="QGIS å®˜æ–¹Plugin æ–‡æ¡£"></a>QGIS å®˜æ–¹Plugin æ–‡æ¡£</h1><h2 id="Official-Version-Whatâ€™s-Next-For-Dialog-Plugins"><a href="#Official-Version-Whatâ€™s-Next-For-Dialog-Plugins" class="headerlink" title="Official Version (Whatâ€™s Next For Dialog Plugins)"></a>Official Version (Whatâ€™s Next For Dialog Plugins)</h2><ol><li>If resources.py is not present in your plugin directory, compile the resources file using pyrcc5 (simply use <code>pb_tool</code> or <code>make</code> if you have automake)</li><li>Optionally, test the generated sources using <code>make test</code> (or run tests from your IDE)</li><li>Copy the entire directory containing your new plugin to the QGIS plugin directory (see Notes below)</li><li>Test the plugin by enabling it in the QGIS plugin manager</li><li>Customize it by editing the implementation file <code>viewshed_analysis.py</code></li><li>Create your own custom icon, replacing the default <code>icon.png</code><br>Modify your user interface by opening <code>viewshed_analysis_dialog_base.ui</code> in Qt Designer</li></ol><h1 id="QGIS-æ’ä»¶å¼€å‘çš„ç¯å¢ƒé…ç½®"><a href="#QGIS-æ’ä»¶å¼€å‘çš„ç¯å¢ƒé…ç½®" class="headerlink" title="QGIS æ’ä»¶å¼€å‘çš„ç¯å¢ƒé…ç½®"></a>QGIS æ’ä»¶å¼€å‘çš„ç¯å¢ƒé…ç½®</h1><h2 id="Environment-Configuration"><a href="#Environment-Configuration" class="headerlink" title="Environment Configuration"></a>Environment Configuration</h2><p>æœ€åŸºç¡€çš„ç‰ˆæœ¬ï¼š<a href="https://zhuanlan.zhihu.com/p/344965380">çŸ¥ä¹ç½‘ç«™ï¼šä»0å¼€å§‹å¼€å‘QGISæ’ä»¶</a></p><p>ç”¨äºè‡ªåŠ¨åˆ›å»º GUI ç•Œé¢çš„ QGIS æ’ä»¶ï¼š<a href="https://www.qgistutorials.com/en/docs/3/processing_python_plugin.html">Building a Processing Plugin</a> (<a href="https://www.osgeo.cn/qgis-tutorial/docs/3/processing_python_plugin.html">In Chinese</a>)</p><blockquote><p>ä¸Šé¢è¿™ä¸ªå·¥å…·æ’ä»¶æœ‰æ•ˆè§£å†³äº†æ’ä»¶GUIçš„é—®é¢˜ï¼Œå¯ä»¥ç›´æ¥ç”¨ä¸QGISé£æ ¼éå¸¸ç»Ÿä¸€çš„GUIè¿›è¡Œå¼€å‘ï¼Œè¿™ä¸ªå·¥å…·åªé€‚ç”¨äºç®—æ³•å¤„ç†ç›¸å…³çš„æ’ä»¶</p></blockquote><h2 id="å¦‚ä½•æŠŠ-Tool-å¯¼å…¥-QGIS-ä¸­"><a href="#å¦‚ä½•æŠŠ-Tool-å¯¼å…¥-QGIS-ä¸­" class="headerlink" title="å¦‚ä½•æŠŠ Tool å¯¼å…¥ QGIS ä¸­"></a>å¦‚ä½•æŠŠ Tool å¯¼å…¥ QGIS ä¸­</h2><ol><li><p>åœ¨ Debug ä¹‹å‰é¦–å…ˆæˆ‘ä»¬éœ€è¦å°†å¼€å‘å¥½çš„æ’ä»¶åŠ å…¥åˆ° QGIS çš„ç¯å¢ƒä¸­ï¼Œè¿™é‡Œæä¾›ä¸¤ç§æ–¹å¼ï¼š</p><ol><li><p>ç›´æ¥æŠŠç”¨ Plugin Builder ç”Ÿæˆå¥½çš„æ•´ä¸ªæ’ä»¶ç›®å½•æ‹·åˆ°<code>C:\Users\---\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins</code></p></li><li><p>è¿™é‡Œæ›´æ¨èç”¨ symbolic link çš„æ–¹æ³•ç›´æ¥åˆ›å»ºè½¯é“¾æ¥ </p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">mklink /D <span class="hljs-string">&quot;C:\Users\---\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins\your_plugin&quot;</span> <span class="hljs-string">&quot;<span class="hljs-variable">$</span>&#123;your_plugin_workspace&#125;\your_plugin&quot;</span><br></code></pre></td></tr></table></figure></li></ol> <div class="note note-warning">            <p>WARNING: There is a huge risk though of losing your code if you uninstall the plugin by accident.</p>          </div></li><li><p>é‡å¯ QGIS, Menu Plugins -&gt; Manage and Install Plugins</p></li><li><p>æŠŠ viewshed analysis æ‰“é’©</p></li><li><p>åœ¨ Plugins èœå•æˆ–è€… Toolbox ä¸­å¯ä»¥æ‰¾åˆ°å¯¹åº”çš„æ’ä»¶</p></li></ol><h1 id="å…³äºä½¿ç”¨-VS-Code-è¿›è¡Œå¼€å‘çš„é—®é¢˜"><a href="#å…³äºä½¿ç”¨-VS-Code-è¿›è¡Œå¼€å‘çš„é—®é¢˜" class="headerlink" title="å…³äºä½¿ç”¨ VS Code è¿›è¡Œå¼€å‘çš„é—®é¢˜"></a>å…³äºä½¿ç”¨ VS Code è¿›è¡Œå¼€å‘çš„é—®é¢˜</h1><div class="note note-warning">            <p>ç”¨ VS Code å¼€å‘æ˜¯ä¸€ä»¶éå¸¸ tricky çš„äº‹æƒ…ï¼Œè¿™å¯èƒ½éœ€è¦éå¸¸é•¿çš„é…ç½®æ—¶é—´</p>          </div><p><strong>å†æ¬¡å£°æ˜ï¼Œå¥½åƒåªæœ‰Windowsæœ‰è¿™ä¹ˆå¤šéº»çƒ¦çš„é—®é¢˜</strong></p><p>å¦å¤–ï¼Œæ ¹æ®å®˜æ–¹ç½‘ç«™çš„æ¨èï¼Œæœ€å¥½ä½¿ç”¨ long-term-release çš„ç‰ˆæœ¬è¿›è¡Œå¼€å‘ é long-term-release çš„ç‰ˆæœ¬çš„è·¯å¾„å¯èƒ½ä¸ä¸‹æ–‡ä¸­çš„æè¿°ç•¥æœ‰åŒºåˆ«ï¼Œä¸»è¦æ˜¯å„ç§è·¯å¾„å’Œæ–‡ä»¶åä¸­ qgis-ltr å’Œ qgis çš„åŒºåˆ«</p><h2 id="å¦‚ä½•åœ¨-Integrated-terminal-è¿è¡Œ"><a href="#å¦‚ä½•åœ¨-Integrated-terminal-è¿è¡Œ" class="headerlink" title="å¦‚ä½•åœ¨ Integrated terminal è¿è¡Œ"></a>å¦‚ä½•åœ¨ Integrated terminal è¿è¡Œ</h2><p>æœ‰å‡ ç§æ–¹æ¡ˆè§£å†³import qgisç›¸å…³çš„é—®é¢˜ï¼š</p><ul><li><p>æ ¹æ®ä»¥ä¸‹æ–‡ä»¶è‡ªå·±é…ç½® settings.jsonï¼Œè¿™äº›æ–‡ä»¶åŸºæœ¬å¯ä»¥åœ¨ QGIS çš„æ ¹ç›®å½•ä¸‹æ‰¾åˆ°</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs bash">%OSGEO4W_ROOT%/bin/python-qgis-ltr.bat    <br>%OSGEO4W_ROOT%/bin/o4w_env.bat    <br>%OSGEO4W_ROOT%/bin/o4w_env.bat<br></code></pre></td></tr></table></figure></li><li><p>åœ¨ Integrated terminal ä¸­è¿è¡Œ <code>%OSGEO4W_ROOT%/bin/python-qgis-ltr-env.bat </code>åå†è¿è¡Œpythonç¨‹åº</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs powershell">rem python<span class="hljs-literal">-qgis-ltr-env</span>.bat    <br>@<span class="hljs-built_in">echo</span> off    call <span class="hljs-string">&quot;%~dp0\o4w_env.bat&quot;</span>   <br>@<span class="hljs-built_in">echo</span> off    path %OSGEO4W_ROOT%\apps\qgis<span class="hljs-literal">-ltr</span>\bin;%PATH%    <br><span class="hljs-built_in">set</span> QGIS_PREFIX_PATH=%OSGEO4W_ROOT:\=/%/apps/qgis<span class="hljs-literal">-ltr</span>   <br><span class="hljs-built_in">set</span> GDAL_FILENAME_IS_UTF8=YES    <br>rem <span class="hljs-built_in">Set</span> VSI cache to be used as buffer, see <span class="hljs-comment">#6448    </span><br><span class="hljs-built_in">set</span> VSI_CACHE=TRUE    <br><span class="hljs-built_in">set</span> VSI_CACHE_SIZE=<span class="hljs-number">1000000</span>    <br><span class="hljs-built_in">set</span> QT_PLUGIN_PATH=%OSGEO4W_ROOT%\apps\qgis<span class="hljs-literal">-ltr</span>\qtplugins;%OSGEO4W_ROOT%\apps\qt5\plugins    <br><span class="hljs-built_in">set</span> PYTHONPATH=%OSGEO4W_ROOT%\apps\qgis<span class="hljs-literal">-ltr</span>\python;%PYTHONPATH%<br></code></pre></td></tr></table></figure></li><li><p>Thanks to <a href="https://gist.github.com/thbaumann/73c873d4c49d8c1add8dc97359cebabe%EF%BC%8C%E6%9C%89%E4%B8%80%E4%B8%AA%E6%9B%B4%E7%AE%80%E5%8D%95%E7%9A%84%E6%96%B9%E6%B3%95%E5%8F%AF%E4%BB%A5%E7%9B%B4%E6%8E%A5%E5%B0%86.bat%E4%BD%9C%E4%B8%BA">https://gist.github.com/thbaumann/73c873d4c49d8c1add8dc97359cebabeï¼Œæœ‰ä¸€ä¸ªæ›´ç®€å•çš„æ–¹æ³•å¯ä»¥ç›´æ¥å°†.batä½œä¸º</a> vscode çš„è§£é‡Šå™¨ (åœ¨ vscode çš„è®¾ç½®ä¸­æ— æ³•å°†é.exeçš„æ–‡ä»¶è®¾ä¸ºè§£é‡Šå™¨)</p><blockquote><p>The bread and butter of this configuration is â€œpython.pythonPathâ€: â€œC:&#x2F;OSGeo4W64&#x2F;bin&#x2F;python-qgis.batâ€, which sets all the correct paths and bindings for us. I donâ€™t really know why it works to refer a .bat file as python interpreter, but apparently itâ€™s fine and fixes alot of linting issues.</p></blockquote></li></ul><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-comment">// settings.json    </span><br><span class="hljs-punctuation">&#123;</span> <br>        <span class="hljs-comment">// ç¬¬ä¸€ä¸ªé€‰é¡¹è²Œä¼¼æ˜¯è¿‡æ—¶çš„</span><br>        <span class="hljs-attr">&quot;python.pythonPath&quot;</span><span class="hljs-punctuation">:</span><span class="hljs-string">&quot; %OSGEO4W_ROOT%\\bin\\python-qgis-ltr.bat&quot;</span><span class="hljs-punctuation">,</span><br>        <span class="hljs-attr">&quot;python.defaultInterpreterPath&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;%OSGEO4W_ROOT%\\bin\\python-qgis-ltr.bat&quot;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ä¸ª tricky çš„ç‚¹æ˜¯ç›¸å¯¹è·¯å¾„å¼•ç”¨çš„é—®é¢˜ï¼š</p><div class="note note-info">            <p>è¿™æ®µä¸œè¥¿æ˜¯é’ˆå¯¹ dialog çš„é‚£ç§è‡ªå·±å†™ GUI çš„ plugin çš„ï¼Œprocessing ç³»åˆ—çš„æ’ä»¶ä¸å¤ªå—åˆ°è¿™ä¸ªå›°æ‰°</p>          </div><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># This works for integragted terminal</span><br><span class="hljs-comment"># Initialize Qt resources from file resources.py</span><br><span class="hljs-keyword">from</span> resources <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># Import the code for the dialog</span><br><span class="hljs-keyword">from</span> visibility_analysis_dialog <span class="hljs-keyword">import</span> VisibilityAnalysisDialog<br><span class="hljs-comment"># --------------------------------------</span><br><span class="hljs-comment"># This works for qgis </span><br><span class="hljs-comment"># Initialize Qt resources from file resources.py</span><br><span class="hljs-keyword">from</span> .resources <span class="hljs-keyword">import</span> *<br><span class="hljs-comment"># Import the code for the dialog</span><br><span class="hljs-keyword">from</span> .visibility_analysis_dialog <span class="hljs-keyword">import</span> VisibilityAnalysisDialog<br></code></pre></td></tr></table></figure><h2 id="Debugging-in-VS-Code"><a href="#Debugging-in-VS-Code" class="headerlink" title="Debugging in VS Code"></a>Debugging in VS Code</h2><blockquote><p>Thanks to<br><a href="https://gispofinland.medium.com/cooking-with-gispo-qgis-plugin-development-in-vs-code-19f95efb1977">https://gispofinland.medium.com/cooking-with-gispo-qgis-plugin-development-in-vs-code-19f95efb1977</a><br><a href="https://gist.github.com/thbaumann/73c873d4c49d8c1add8dc97359cebabe">https://gist.github.com/thbaumann/73c873d4c49d8c1add8dc97359cebabe</a></p></blockquote><p>åˆ©ç”¨ VS Code å¯¹ QGIS æ’ä»¶è¿›è¡Œå¼€å‘éœ€è¦åˆ©ç”¨ QGIS ä¸­çš„ Debugvs æ’ä»¶ï¼Œè¿™ä¸ªæ’ä»¶ä¼šåœ¨æœ¬åœ°çš„ 5678 ç«¯å£åˆ›å»ºä¸€ä¸ª debug çš„ä¼ è¾“é€šé“ï¼Œè®© VS Code çš„ debug launch å¯ä»¥è¿›è¡Œè¿œç¨‹çš„ attach debuggingã€‚</p><p>åœ¨å®‰è£…è¿™ä¸ªæ’ä»¶ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ <strong>QGIS å¯¹åº”çš„ python ç›®å½•ä¸‹</strong>å®‰è£… ptvsd</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell">pip install ptvsd<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>è¿™é‡Œå»ºè®®ä¸€å®šåœ¨å®‰è£…ä¹‹å‰æ£€æŸ¥ä¸€ä¸‹å½“å‰ Python çš„ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼Œå»ºè®®ç›´æ¥æ‰“å¼€ OSGeo4W shell è¿›è¡Œé…ç½®ï¼ˆé€šå¸¸åœ¨<code>%OSGeo4w_ROOT\OSGeo4W.bat</code>ï¼‰<br>ä¹‹åç›´æ¥åœ¨ QGIS ä¸­å®‰è£… Debugvs å³å¯</p>          </div><p>æˆ‘ä»¬è¿˜éœ€è¦é¢å¤–é…ç½®ä¸€ä¸‹ VS Code çš„ <code>launch.json</code></p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>    <span class="hljs-attr">&quot;name&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;Python: Remote Attach&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;type&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;python&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;request&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;attach&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;port&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-number">5678</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;host&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;localhost&quot;</span><span class="hljs-punctuation">,</span><br>    <span class="hljs-attr">&quot;pathMappings&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><br>        <span class="hljs-punctuation">&#123;</span><br>            <span class="hljs-attr">&quot;localRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;$&#123;workspaceFolder&#125;/your_plugin&quot;</span><span class="hljs-punctuation">,</span> <span class="hljs-comment">// path to your plugin where you are developing</span><br>            <span class="hljs-attr">&quot;remoteRoot&quot;</span><span class="hljs-punctuation">:</span> <span class="hljs-string">&quot;C:\\Users\\---\\AppData\\Roaming\\QGIS\\QGIS3\\profiles\\default\\python\\plugins\\your_plugin&quot;</span> <span class="hljs-comment">// path to where the QGIS plugin folder lives </span><br>        <span class="hljs-punctuation">&#125;</span><br>    <span class="hljs-punctuation">]</span><br><span class="hljs-punctuation">&#125;</span><span class="hljs-punctuation">,</span><br></code></pre></td></tr></table></figure><p>å®‰è£…å¥½ä¹‹ååœ¨ QGIS ä¸­ç‚¹å‡» <code>Plugins -&gt; Enable Debug for Visual Studio -&gt; Enable Debug for Visual Studio</code> å³å¯æ‰“å¼€ Debug Port (localhost:5678)ï¼Œéšååœ¨ VS Code ä¸­ç›´æ¥è¿è¡Œ Debug å³å¯</p><p>æ¯ä¸€æ¬¡ä¿®æ”¹ä¹‹åéƒ½è¦ç”¨ <code>Plugin Reloader</code> reload ä¸€æ¬¡</p>]]></content>
    
    
    <categories>
      
      <category>GIS</category>
      
    </categories>
    
    
    <tags>
      
      <tag>VS Code</tag>
      
      <tag>Python</tag>
      
      <tag>QGIS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>hexo å»ºç«™æ€»ç»“</title>
    <link href="/2023/10/22/hexo-%E5%BB%BA%E7%AB%99/"/>
    <url>/2023/10/22/hexo-%E5%BB%BA%E7%AB%99/</url>
    
    <content type="html"><![CDATA[<h1 id="Hexo-å»ºç«™è¿‡ç¨‹"><a href="#Hexo-å»ºç«™è¿‡ç¨‹" class="headerlink" title="Hexo å»ºç«™è¿‡ç¨‹"></a>Hexo å»ºç«™è¿‡ç¨‹</h1><h2 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h2><ol><li><p>ä¸€ä¸ª Github è´¦å·ï¼Œ<a href="https://blog.csdn.net/yaorongke/article/details/119086305">ç”³è¯·æ•™ç¨‹</a></p></li><li><p>åœ¨ç”µè„‘ä¸Šå®‰è£… gitï¼Œ[gitå®‰è£…æ•™ç¨‹]åœ¨(<a href="https://blog.csdn.net/yaorongke/article/details/119085413">https://blog.csdn.net/yaorongke/article/details/119085413</a>)</p></li><li><p>åœ¨ç”µè„‘ä¸Šå®‰è£… NodeJSï¼Œ<a href="https://blog.csdn.net/yaorongke/article/details/119084295">NodeJSå®‰è£…æ•™ç¨‹</a></p></li></ol><h2 id="Hexo-å®‰è£…å’Œæœ¬åœ°æµ‹è¯•"><a href="#Hexo-å®‰è£…å’Œæœ¬åœ°æµ‹è¯•" class="headerlink" title="Hexo å®‰è£…å’Œæœ¬åœ°æµ‹è¯•"></a>Hexo å®‰è£…å’Œæœ¬åœ°æµ‹è¯•</h2><ol><li><p>å®‰è£… hexo</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">npm install -g hexo-cli<br></code></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹ hexo ç‰ˆæœ¬</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo -v<br></code></pre></td></tr></table></figure></li><li><p>åˆ›å»º blog</p><figure class="highlight dust"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dust"><span class="language-xml">hexo init </span><span class="hljs-template-variable">&#123;YOUR_BLOG_NAME&#125;</span><span class="language-xml"></span><br><span class="language-xml">cd </span><span class="hljs-template-variable">&#123;YOUR_BLOG_NAME&#125;</span><span class="language-xml"></span><br><span class="language-xml">npm install</span><br></code></pre></td></tr></table></figure></li><li><p>blogçš„æœ¬åœ°å¯åŠ¨</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">hexo g -d <span class="hljs-comment"># generate and deploy</span><br>hexo s <span class="hljs-comment"># server</span><br></code></pre></td></tr></table></figure></li><li><p>æµè§ˆå™¨è®¿é—® <code>http://localhost:4000</code> å³å¯æ‰“å¼€æ–°å»ºçš„åšå®¢ï¼Œé¡µé¢çš„é»˜è®¤é£æ ¼å¦‚ä¸‹<br><img src="/2023/10/22/hexo-%E5%BB%BA%E7%AB%99/hexo_default.png" alt="hexoé»˜è®¤é¡µé¢"></p></li></ol><p>Hexo çš„é»˜è®¤ä¸»é¢˜å¯èƒ½æ¯”è¾ƒä¸‘é™‹ï¼Œä¸è¿‡hexoæœ¬èº«æä¾›äº†å¾ˆå¤šä¸åŒçš„ä¸»é¢˜ï¼Œæ¯”è¾ƒå¸¸ç”¨ï¼ˆäº’è”ç½‘ä¸Šèµ„æºè¾ƒå¤šçš„ï¼‰æœ‰ <a href="https://theme-next.js.org/">NeXT</a> å’Œ <a href="https://hexo.fluid-dev.com/">Fluid</a></p><h2 id="Github-pageséƒ¨ç½²"><a href="#Github-pageséƒ¨ç½²" class="headerlink" title="Github pageséƒ¨ç½²"></a>Github pageséƒ¨ç½²</h2><h1 id="Hexo-å®˜æ–¹-Hello-world"><a href="#Hexo-å®˜æ–¹-Hello-world" class="headerlink" title="Hexo å®˜æ–¹ Hello world"></a>Hexo å®˜æ–¹ Hello world</h1><div class="note note-info">            <p>è¿™ä¸ªå®˜æ–¹çš„ Hello world å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªæ“ä½œæ‰‹å†Œ</p>          </div><p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p><h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo new <span class="hljs-string">&quot;My New Post&quot;</span><br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p><h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo server<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p><h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo generate<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p><h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">$ hexo deploy<br></code></pre></td></tr></table></figure><p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢å»ºç«™</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>åšå®¢ç¾åŒ–è‡ªè¿°</title>
    <link href="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/"/>
    <url>/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™é‡Œä¸»è¦è®°å½•ä¸€ä¸‹æœ¬åšå®¢å»ºç«™è¿‡ç¨‹ä¸­ç”¨åˆ°çš„ç¾åŒ–æ‰‹æ®µå…±å‚è€ƒè€ƒ</p></blockquote><h1 id="è®¿é—®é‡ç»Ÿè®¡"><a href="#è®¿é—®é‡ç»Ÿè®¡" class="headerlink" title="è®¿é—®é‡ç»Ÿè®¡"></a>è®¿é—®é‡ç»Ÿè®¡</h1><p><code>Fluid</code> ä¸»é¢˜ä¸­é’ˆå¯¹é˜…è¯»é‡å·²ç»æœ‰å†™å¥½çš„ä»£ç ï¼Œä½†æ˜¯éœ€è¦è‡ªå·±é…ç½®ç¬¬ä¸‰æ–¹çš„æ•°æ®é‡ç»Ÿè®¡æœåŠ¡æ‰èƒ½ä½¿ç”¨ã€‚æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ <code>LeanCloud</code> çš„å…è´¹æœåŠ¡æ¥è¿›è¡Œç»Ÿè®¡ï¼ŒåŒæ—¶è¿™ä¸ªä¹Ÿå¯ä»¥ç›´æ¥ç”¨æ¥æ¥å…¥åé¢çš„è¯„è®ºåŒº</p><h2 id="1-ç”³è¯·-LeanCloud-è´¦å·å¹¶åˆ›å»ºåº”ç”¨"><a href="#1-ç”³è¯·-LeanCloud-è´¦å·å¹¶åˆ›å»ºåº”ç”¨" class="headerlink" title="1. ç”³è¯· LeanCloud è´¦å·å¹¶åˆ›å»ºåº”ç”¨"></a>1. ç”³è¯· LeanCloud è´¦å·å¹¶åˆ›å»ºåº”ç”¨</h2><p>è¿›å…¥<a href="https://console.leancloud.cn/">å®˜ç½‘</a> æ³¨å†Œè´¦å·</p><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/%E6%B3%A8%E5%86%8C.png" alt="æ³¨å†Œé¡µé¢"></p><p>æ³¨å†Œåéœ€è¦å®åè®¤è¯å’Œé‚®ç®±éªŒè¯ï¼Œå®Œæˆåæ‰èƒ½ä½¿ç”¨å„é¡¹æœåŠ¡</p><p>éªŒè¯å®Œæˆåé€‰æ‹©åˆ›å»ºåº”ç”¨ï¼Œé€‰æ‹©å…è´¹çš„å¼€å‘ç‰ˆå³å¯</p><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/%E5%88%9B%E5%BB%BA%E5%BA%94%E7%94%A8.png" alt="åˆ›å»ºåº”ç”¨"></p><p>è¿›å…¥è¯¥åº”ç”¨çš„ <code>è®¾ç½®-&gt;åº”ç”¨å‡­è¯</code>ï¼Œæ‰¾åˆ° <code>AppID</code>, <code>AppKey</code>, <code>REST API æœåŠ¡å™¨åœ°å€</code> ä¸‰ä¸ªå±æ€§ï¼Œè®°å½•ä¸‹æ¥åé¢ä½¿ç”¨</p><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/%E5%BA%94%E7%94%A8%E8%AE%B0%E5%BD%95.png" alt="åº”ç”¨è®°å½•"></p><h2 id="2-ä¿®æ”¹-Fluid-é…ç½®"><a href="#2-ä¿®æ”¹-Fluid-é…ç½®" class="headerlink" title="2 ä¿®æ”¹ Fluid é…ç½®"></a>2 ä¿®æ”¹ Fluid é…ç½®</h2><p>åœ¨ <code>_config.fluid.yml</code> ä¸­æˆ–è€… fluid ä¸»é¢˜çš„ <code>_config.yml</code> ä¸­ä¿®æ”¹æ‰¾åˆ°ä»¥ä¸‹é…ç½®é¡¹ï¼ŒæŒ‰ç…§ä¸‹æ–‡å†…å®¹ä¿®æ”¹é…ç½®</p><h3 id="ç½‘é¡µè®¿é—®ç»Ÿè®¡é…ç½®"><a href="#ç½‘é¡µè®¿é—®ç»Ÿè®¡é…ç½®" class="headerlink" title="ç½‘é¡µè®¿é—®ç»Ÿè®¡é…ç½®"></a>ç½‘é¡µè®¿é—®ç»Ÿè®¡é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">web_analytics:</span>  <span class="hljs-comment"># ç½‘é¡µè®¿é—®ç»Ÿè®¡</span><br>  <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>  <span class="hljs-comment"># LeanCloud è®¡æ•°ç»Ÿè®¡ï¼Œå¯ç”¨äº PV UV å±•ç¤ºï¼Œå¦‚æœ `web_analytics: enable` æ²¡æœ‰å¼€å¯ï¼ŒPV UV å±•ç¤ºåªä¼šæŸ¥è¯¢ä¸ä¼šå¢åŠ </span><br>  <span class="hljs-comment"># LeanCloud count statistics, which can be used for PV UV display. If `web_analytics: enable` is false, PV UV display will only query and not increase</span><br>  <span class="hljs-attr">leancloud:</span><br>    <span class="hljs-attr">app_id:</span> <span class="hljs-string">ä½ çš„</span> <span class="hljs-string">AppId</span><br>    <span class="hljs-attr">app_key:</span> <span class="hljs-string">ä½ çš„</span> <span class="hljs-string">AppKey</span><br>    <span class="hljs-comment"># REST API æœåŠ¡å™¨åœ°å€ï¼Œå›½é™…ç‰ˆä¸å¡«</span><br>    <span class="hljs-comment"># Only the Chinese mainland users need to set</span><br>    <span class="hljs-attr">server_url:</span> <span class="hljs-string">ä½ çš„</span> <span class="hljs-string">REST</span> <span class="hljs-string">API</span> <span class="hljs-string">æœåŠ¡å™¨åœ°å€</span><br>    <span class="hljs-comment"># ç»Ÿè®¡é¡µé¢æ—¶è·å–è·¯å¾„çš„å±æ€§</span><br>    <span class="hljs-comment"># Get the attribute of the page path during statistics</span><br>    <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>    <span class="hljs-comment"># å¼€å¯åä¸ç»Ÿè®¡æœ¬åœ°è·¯å¾„( localhost ä¸ 127.0.0.1 )</span><br>    <span class="hljs-comment"># If true, ignore localhost &amp; 127.0.0.1</span><br>    <span class="hljs-attr">ignore_local:</span> <span class="hljs-literal">false</span><br><br></code></pre></td></tr></table></figure><h3 id="æ‰“å¼€æ–‡ç« çš„æµè§ˆé‡è®¡æ•°åŠŸèƒ½"><a href="#æ‰“å¼€æ–‡ç« çš„æµè§ˆé‡è®¡æ•°åŠŸèƒ½" class="headerlink" title="æ‰“å¼€æ–‡ç« çš„æµè§ˆé‡è®¡æ•°åŠŸèƒ½"></a>æ‰“å¼€æ–‡ç« çš„æµè§ˆé‡è®¡æ•°åŠŸèƒ½</h3><p>è¿™ä¸ªåœ¨ <code>_config.fluid.yml</code> çš„ post é…ç½®ä¸‹</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>    <span class="hljs-comment"># æµè§ˆé‡è®¡æ•°</span><br>    <span class="hljs-comment"># Number of visits</span><br>    <span class="hljs-attr">views:</span><br>      <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-comment"># ç»Ÿè®¡æ•°æ®æ¥æº</span><br>      <span class="hljs-comment"># Data Source</span><br>      <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>      <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;leancloud&quot;</span><br>      <span class="hljs-attr">format:</span> <span class="hljs-string">&quot;&#123;&#125; æ¬¡&quot;</span><br></code></pre></td></tr></table></figure><h3 id="é¡µé¢åº•éƒ¨å±•ç¤ºç½‘ç«™çš„-PVï¼ŒUV"><a href="#é¡µé¢åº•éƒ¨å±•ç¤ºç½‘ç«™çš„-PVï¼ŒUV" class="headerlink" title="é¡µé¢åº•éƒ¨å±•ç¤ºç½‘ç«™çš„ PVï¼ŒUV"></a>é¡µé¢åº•éƒ¨å±•ç¤ºç½‘ç«™çš„ PVï¼ŒUV</h3><p>åœ¨ <code>footer</code> é…ç½®é¡¹ä¸­åšè°ƒæ•´</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">footer:</span><br>  <span class="hljs-comment"># å±•ç¤ºç½‘ç«™çš„ PVã€UV ç»Ÿè®¡æ•°</span><br>  <span class="hljs-comment"># Display website PV and UV statistics</span><br>  <span class="hljs-attr">statistics:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br><br>    <span class="hljs-comment"># ç»Ÿè®¡æ•°æ®æ¥æºï¼Œä½¿ç”¨ leancloud éœ€è¦è®¾ç½® `web_analytics: leancloud` ä¸­çš„å‚æ•°ï¼›ä½¿ç”¨ busuanzi ä¸éœ€è¦é¢å¤–è®¾ç½®ï¼Œä½†æ˜¯æœ‰æ—¶ä¸ç¨³å®šï¼Œå¦å¤–æœ¬åœ°è¿è¡Œæ—¶ busuanzi æ˜¾ç¤ºç»Ÿè®¡æ•°æ®å¾ˆå¤§å±äºæ­£å¸¸ç°è±¡ï¼Œéƒ¨ç½²åä¼šæ­£å¸¸</span><br>    <span class="hljs-comment"># Data source. If use leancloud, you need to set the parameter in `web_analytics: leancloud`</span><br>    <span class="hljs-comment"># Options: busuanzi | leancloud</span><br>    <span class="hljs-attr">source:</span> <span class="hljs-string">&quot;leancloud&quot;</span><br><br>    <span class="hljs-attr">pv_format:</span> <span class="hljs-string">&quot;æ€»è®¿é—®é‡ &#123;&#125; æ¬¡&quot;</span><br>    <span class="hljs-attr">uv_format:</span> <span class="hljs-string">&quot;æ€»è®¿å®¢æ•° &#123;&#125; äºº&quot;</span><br></code></pre></td></tr></table></figure><h2 id="é¡µé¢æ•ˆæœ"><a href="#é¡µé¢æ•ˆæœ" class="headerlink" title="é¡µé¢æ•ˆæœ"></a>é¡µé¢æ•ˆæœ</h2><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/%E6%96%87%E7%AB%A0%E6%B5%8F%E8%A7%88%E9%87%8F.png" alt="æ–‡ç« æµè§ˆé‡"></p><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/pvuv.png" alt="pv &amp; uv"></p><h1 id="è¯„è®ºåŠŸèƒ½"><a href="#è¯„è®ºåŠŸèƒ½" class="headerlink" title="è¯„è®ºåŠŸèƒ½"></a>è¯„è®ºåŠŸèƒ½</h1><p>è¯„è®ºåŠŸèƒ½ç›¸å…³çš„ä»£ç åŒæ ·æ˜¯ Fluid æœ¬èº«å†™å¥½çš„ï¼Œä¿®æ”¹ä¸€äº›é…ç½®å³å¯ï¼Œæˆ‘ä»¬è¿™é‡Œä½¿ç”¨åŸºäº leancloud çš„ valine æ¥é…ç½®</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">post:</span><br>  <span class="hljs-attr">comments:</span><br>    <span class="hljs-attr">enable:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># æŒ‡å®šçš„æ’ä»¶ï¼Œéœ€è¦åŒæ—¶è®¾ç½®å¯¹åº”æ’ä»¶çš„å¿…è¦å‚æ•°</span><br>    <span class="hljs-comment"># The specified plugin needs to set the necessary parameters at the same time</span><br>    <span class="hljs-comment"># Options: utterances | disqus | gitalk | valine | waline | changyan | livere | remark42 | twikoo | cusdis | giscus | discuss</span><br>    <span class="hljs-attr">type:</span> <span class="hljs-string">valine</span><br><br><span class="hljs-attr">valine:</span><br>  <span class="hljs-attr">appId:</span> <span class="hljs-string">ä½ çš„</span> <span class="hljs-string">LeanCloud</span> <span class="hljs-string">AppID</span><br>  <span class="hljs-attr">appKey:</span> <span class="hljs-string">ä½ çš„</span> <span class="hljs-string">LeanCloud</span> <span class="hljs-string">AppKey</span><br>  <span class="hljs-attr">path:</span> <span class="hljs-string">window.location.pathname</span><br>  <span class="hljs-attr">placeholder:</span> <span class="hljs-string">è¯´ç‚¹ä»€ä¹ˆ...</span><br>  <span class="hljs-attr">avatar:</span> <span class="hljs-string">&#x27;retro&#x27;</span><br>  <span class="hljs-attr">meta:</span> [<span class="hljs-string">&#x27;nick&#x27;</span>, <span class="hljs-string">&#x27;mail&#x27;</span>, <span class="hljs-string">&#x27;link&#x27;</span>]<br>  <span class="hljs-attr">requiredFields:</span> []<br>  <span class="hljs-attr">pageSize:</span> <span class="hljs-number">10</span><br>  <span class="hljs-attr">lang:</span> <span class="hljs-string">&#x27;zh-CN&#x27;</span><br>  <span class="hljs-attr">highlight:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">recordIP:</span> <span class="hljs-literal">false</span><br>  <span class="hljs-attr">serverURLs:</span> <span class="hljs-string">&#x27;&#x27;</span><br>  <span class="hljs-attr">emojiCDN:</span><br>  <span class="hljs-attr">emojiMaps:</span><br>  <span class="hljs-attr">enableQQ:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h2 id="é¡µé¢æ•ˆæœ-1"><a href="#é¡µé¢æ•ˆæœ-1" class="headerlink" title="é¡µé¢æ•ˆæœ"></a>é¡µé¢æ•ˆæœ</h2><p><img src="/2023/10/07/%E5%8D%9A%E5%AE%A2%E7%BE%8E%E5%8C%96%E8%87%AA%E8%BF%B0/comments.png" alt="å‘è¡¨è¯„è®º"></p><h1 id="å…¶ä»–æ’ä»¶"><a href="#å…¶ä»–æ’ä»¶" class="headerlink" title="å…¶ä»–æ’ä»¶"></a>å…¶ä»–æ’ä»¶</h1><p>è¿™éƒ¨åˆ†æ’ä»¶é€šå¸¸éœ€è¦ç”¨åˆ°é¢å¤–çš„ js&#x2F;css æ–‡ä»¶ï¼Œéœ€è¦æ·»åŠ åˆ° <code>source/js</code> æ–‡ä»¶å¤¹ä¸­</p><blockquote><p>æ‰€æœ‰è¿™éƒ¨åˆ†æ–‡ä»¶éƒ½å¯ä»¥åœ¨<a href="https://github.com/duhaode520/duhaode520.github.io">åšå®¢åŸå§‹ repo </a>çš„ source æ–‡ä»¶å¤¹ä¸­æ‰¾åˆ°</p></blockquote><h2 id="æ·»åŠ ä¸»é¡µåˆ›å»ºæ—¶é—´"><a href="#æ·»åŠ ä¸»é¡µåˆ›å»ºæ—¶é—´" class="headerlink" title="æ·»åŠ ä¸»é¡µåˆ›å»ºæ—¶é—´"></a>æ·»åŠ ä¸»é¡µåˆ›å»ºæ—¶é—´</h2><p>åœ¨ <code>_config.fluid.yml</code> ä¸­æ‰¾åˆ° <code>footer</code> è¿›è¡Œæ·»åŠ </p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">footer:</span><br>  <span class="hljs-comment"># é¡µè„šç¬¬ä¸€è¡Œæ–‡å­—çš„ HTMLï¼Œå»ºè®®ä¿ç•™ Fluid çš„é“¾æ¥ï¼Œç”¨äºå‘æ›´å¤šäººæ¨å¹¿æœ¬ä¸»é¢˜</span><br>  <span class="hljs-comment"># HTML of the first line of the footer, it is recommended to keep the Fluid link to promote this theme to more people</span><br>  <span class="hljs-attr">content:</span> <span class="hljs-string">&#x27;</span><br><span class="hljs-string">    &lt;div&gt;</span><br><span class="hljs-string">      &lt;span id=&quot;timeDate&quot;&gt;è½½å…¥å¤©æ•°...&lt;/span&gt;</span><br><span class="hljs-string">      &lt;span id=&quot;times&quot;&gt;è½½å…¥æ—¶åˆ†ç§’...&lt;/span&gt;</span><br><span class="hljs-string">      &lt;script src=&quot;/js/duration.js&quot;&gt;&lt;/script&gt;</span><br><span class="hljs-string">    &lt;/div&gt;</span><br></code></pre></td></tr></table></figure><p>ç„¶ååˆ›å»ºæ–‡ä»¶ <code>source/js/duration.js</code>ï¼Œå…¶ä¸­å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs javascript"><span class="hljs-keyword">var</span> now = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br><span class="hljs-keyword">function</span> <span class="hljs-title function_">createtime</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> grt= <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&quot;03/10/2023 00:00:00&quot;</span>);<span class="hljs-comment">//åœ¨æ­¤å¤„ä¿®æ”¹ä½ çš„å»ºç«™æ—¶é—´ï¼Œæ ¼å¼ï¼šæœˆ/æ—¥/å¹´ æ—¶:åˆ†:ç§’</span><br>    now.<span class="hljs-title function_">setTime</span>(now.<span class="hljs-title function_">getTime</span>()+<span class="hljs-number">250</span>);<br>    days = (now - grt ) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> / <span class="hljs-number">24</span>; dnum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(days);<br>    hours = (now - grt ) / <span class="hljs-number">1000</span> / <span class="hljs-number">60</span> / <span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * dnum); hnum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(hours);<br>    <span class="hljs-keyword">if</span>(<span class="hljs-title class_">String</span>(hnum).<span class="hljs-property">length</span> ==<span class="hljs-number">1</span> )&#123;hnum = <span class="hljs-string">&quot;0&quot;</span> + hnum;&#125; minutes = (now - grt ) / <span class="hljs-number">1000</span> /<span class="hljs-number">60</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * hnum);<br>    mnum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(minutes); <span class="hljs-keyword">if</span>(<span class="hljs-title class_">String</span>(mnum).<span class="hljs-property">length</span> ==<span class="hljs-number">1</span> )&#123;mnum = <span class="hljs-string">&quot;0&quot;</span> + mnum;&#125;<br>    seconds = (now - grt ) / <span class="hljs-number">1000</span> - (<span class="hljs-number">24</span> * <span class="hljs-number">60</span> * <span class="hljs-number">60</span> * dnum) - (<span class="hljs-number">60</span> * <span class="hljs-number">60</span> * hnum) - (<span class="hljs-number">60</span> * mnum);<br>    snum = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(seconds); <span class="hljs-keyword">if</span>(<span class="hljs-title class_">String</span>(snum).<span class="hljs-property">length</span> ==<span class="hljs-number">1</span> )&#123;snum = <span class="hljs-string">&quot;0&quot;</span> + snum;&#125;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;timeDate&quot;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;æœ¬ç«™å·²å®‰å…¨è¿è¡Œ &quot;</span>+dnum+<span class="hljs-string">&quot; å¤© &quot;</span>;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;times&quot;</span>).<span class="hljs-property">innerHTML</span> = hnum + <span class="hljs-string">&quot; å°æ—¶ &quot;</span> + mnum + <span class="hljs-string">&quot; åˆ† &quot;</span> + snum + <span class="hljs-string">&quot; ç§’&quot;</span>;<br>&#125;<br><span class="hljs-built_in">setInterval</span>(<span class="hljs-string">&quot;createtime()&quot;</span>,<span class="hljs-number">250</span>);<br></code></pre></td></tr></table></figure><h2 id="åŠ¨æ€å½©å¸¦"><a href="#åŠ¨æ€å½©å¸¦" class="headerlink" title="åŠ¨æ€å½©å¸¦"></a>åŠ¨æ€å½©å¸¦</h2><p>é¦–å…ˆåœ¨ <code>_config.fluid.yml</code> ä¸­æ‰¾åˆ° <code>custom.js</code> è¿›è¡Œæ·»åŠ :</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">custom_js:</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-string">/js/DynamicRobbin.js</span><br></code></pre></td></tr></table></figure><p>ç„¶åæ·»åŠ æ–‡ä»¶ <code>source/js/DynamicRobbin.js</code>ï¼Œåœ¨é¡¹ç›®repoä¸­ç›´æ¥æ‹·è´å³å¯ï¼š<a href="https://github.com/duhaode520/duhaode520.github.io/tree/main/source/js/DynamicRobbin.js">https://github.com/duhaode520/duhaode520.github.io/tree/main/source/js/DynamicRobbin.js</a>  </p>]]></content>
    
    
    <categories>
      
      <category>åšå®¢å»ºç«™</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æµ‹è¯•æ–‡ç« </title>
    <link href="/2023/10/06/test-article/"/>
    <url>/2023/10/06/test-article/</url>
    
    <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡æµ‹è¯•æ–‡ç« </p><img src="/2023/10/06/test-article/test.png" class="" title="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸€"><p><img src="/2023/10/06/test-article/test.png" alt="å›¾ç‰‡å¼•ç”¨æ–¹æ³•äºŒ"></p><p><img src="/images/test.png" alt="å›¾ç‰‡å¼•ç”¨æ–¹æ³•ä¸‰"></p>]]></content>
    
    
    <categories>
      
      <category>test</category>
      
    </categories>
    
    
    <tags>
      
      <tag>test</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Zookeeperç®€ä»‹</title>
    <link href="/2023/04/22/Zookeeper%E7%AE%80%E4%BB%8B/"/>
    <url>/2023/04/22/Zookeeper%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<p>Zookeeper å¯ä»¥ç”¨æ¥æ„å»ºä¸€èˆ¬çš„åˆ†å¸ƒå¼åº”ç”¨ï¼Œå¯¹éƒ¨åˆ†å¤±è´¥è¿›è¡Œæ­£ç¡®çš„å¤„ç†</p><div class="note note-primary">            <p>ğŸ’¡ ä»€ä¹ˆæ˜¯éƒ¨åˆ†å¤±è´¥ï¼Ÿç®€å•æ¥è®²å°±æ˜¯æ¶ˆæ¯åœ¨ç½‘ç»œä¸­ä¼ è¾“çš„ä¸€æ–¹ä¸çŸ¥é“å¦ä¸€æ–¹æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œæ¯”å¦‚æ¥å—è€…downæ‰æˆ–è€…æ ¹æœ¬æ²¡æœ‰æ¥å—åˆ°ï¼Œå‘é€æ–¹æ˜¯ä¸èƒ½çŸ¥é“è¿™æ¡ä¸ªæ“ä½œæ˜¯ä¸æ˜¯å·²ç»å¤±è´¥çš„</p>          </div><p>Zookeeper çš„ä¸€äº›æ ¸å¿ƒç†å¿µï¼š</p><ul><li>ç²¾ç®€çš„æ–‡ä»¶ç³»ç»Ÿ</li><li>é«˜å¯ç”¨æ€§ï¼šé¿å…å‡ºç°å•ç‚¹æ•…éšœï¼Œæ„å»ºå¯é åº”ç”¨</li><li>æ¾è€¦åˆï¼šè®©<strong>è¿›ç¨‹åœ¨ä¸äº†è§£å…¶ä»–è¿›ç¨‹ï¼ˆæˆ–ç½‘ç»œçŠ¶å†µï¼‰çš„æƒ…å†µ</strong>ä¸‹èƒ½å¤Ÿå½¼æ­¤å‘ç°å¹¶å®ç°äº¤äº’ï¼Œç”šè‡³ä¸è¦æ±‚äºŒè€…æ˜¯åŒæ—¶å­˜åœ¨çš„</li><li>é«˜æ€§èƒ½ï¼š10000ops +</li></ul><p>Zookeeper çš„ä¸€äº›å‘½ä»¤è¡ŒæŒ‡ä»¤ï¼šåŸºæœ¬éƒ½æ˜¯4ä¸ªå•è¯çš„ï¼Œé€šå¸¸åœ¨ portï¼š2181 è¿›è¡Œç›‘è§†</p><h2 id="Zookeeper-æœåŠ¡"><a href="#Zookeeper-æœåŠ¡" class="headerlink" title="Zookeeper æœåŠ¡"></a>Zookeeper æœåŠ¡</h2><h3 id="æ•°æ®æ¨¡å‹"><a href="#æ•°æ®æ¨¡å‹" class="headerlink" title="æ•°æ®æ¨¡å‹"></a>æ•°æ®æ¨¡å‹</h3><p>Zookeeper è¢«è®¾è®¡ç”¨æ¥å®ç°åè°ƒæœåŠ¡ï¼Œå…¶æ•°æ®çš„è®¿é—®å…·æœ‰åŸå­æ€§</p><div class="note note-primary">            <p>ğŸ’¡ ä¹Ÿå°±æ˜¯è¯´ä¸ HDFS ä¸åŒï¼Œå…¶è¯»å–æ•°æ®æ—¶ä¸ä¼šå‡ºç°éƒ¨åˆ†è¯»ï¼Œè¦ä¹ˆæˆåŠŸï¼Œè¦ä¹ˆå¤±è´¥ï¼ŒåŒæ ·çš„ï¼Œå¯¹äºå†™æ“ä½œæ¥è¯´ï¼Œå…¶ä¹Ÿä¼šä¸€æ¬¡æ€§æ›´æ–° znode ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œè€Œä¸æ˜¯åªåœ¨æœ€åè¿›è¡Œæ·»åŠ ã€‚<br>Zookeeperä¿è¯äº†è¯»å†™çš„åŸå­æ€§</p>          </div><p><strong>znode</strong></p><p>znode åˆ†ä¸ºçŸ­æš‚ znode å’Œæ°¸ä¹… znodeã€‚å…¶ä¸­æ°¸ä¹… znode éœ€è¦æ˜¾å¼åœ°è¢«åˆ é™¤ï¼Œè€ŒçŸ­æš‚ znode åœ¨<strong>å½“å‰å®¢æˆ·ç«¯çš„ä¼šè¯</strong>ç»“æŸæ—¶å°±ä¼šæ¶ˆå¤±</p><div class="note note-primary">            <p>ğŸ’¡ å…³äºä¼šè¯ï¼ˆsessionï¼‰å’Œè¿æ¥ï¼ˆconnectï¼‰ä¹‹é—´çš„åŒºåˆ«ï¼Œè¯·çœ‹åæ–‡çš„å†…å®¹</p>          </div><p>çŸ­æš‚ znode ä¸å¯ä»¥ç”¨æœ‰å­èŠ‚ç‚¹ï¼Œå…¶æ¯”è¾ƒé€‚åˆå®ç°ç»„æˆå‘˜ç®¡ç†ï¼Œè®©è¿›ç¨‹çŸ¥é“ç‰¹å®šçš„æ—¶åˆ»æœ‰é‚£äº›å­æˆå‘˜å¯ä»¥è¢«ä½¿ç”¨ã€‚</p><div class="note note-info">            <p>ğŸ’¡ è¯¦æƒ…è§ 21.2.3, 21.2.4 ä¸­ <code>JoinNode</code> å’Œ <code>ListNode</code> çš„ä¾‹å­ï¼ŒçŸ­æš‚ znode æ·»åŠ çš„å­æˆå‘˜èƒ½å¤Ÿè¢« <code>ListNode</code> åœ¨ä»–ä»¬ä¸çŸ¥æƒ…çš„æƒ…å†µä¸‹å‘ç°ã€‚</p>          </div><p><strong><strong><strong>Sequence Number</strong></strong></strong></p><p>é¡ºåºå·å¯ä»¥ç»™å…¨å±€çš„åŒåæ—¶é—´æ’åˆ—é¡ºåºï¼Œæ¯”å¦‚ä¸¤ä¸ªå…ˆåæœ‰ä¸åŒå®¢æˆ·ç«¯åˆ›å»ºçš„ znode åœ¨ Zookeeper è·¯å¾„ä¸­ä¼šè¢«ç®¡ç†ä¸º <code>/a/b-2</code> å’Œ <code>/a/b-3</code> ã€‚é¡ºåºå·å¹¶ä¸ä¼šåœ¨è·¯å¾„è®¿é—®ä¸­è¢«æ˜¾å¼éœ€è¦ã€‚</p><div class="note note-info">            <p>ğŸ’¡ é¡ºåºå·æ¶‰åŠåˆ°äº† Zookeeper å¦å¤–ä¸€ä¸ªéå¸¸é‡è¦çš„åŠŸèƒ½ï¼Œå°±æ˜¯å®ç°åˆ†å¸ƒå¼é”</p>          </div><p><strong>Watch</strong></p><p>æ¯ä¸€ä¸ª znode éƒ½å¯ä»¥è®¾ç½®å¤šä¸ªè§‚å¯Ÿï¼Œæœ‰ä¸åŒçš„å¯¹äº znode çš„æ“ä½œå¯ä»¥è§¦å‘è§‚å¯Ÿã€‚è§‚å¯Ÿåœ¨è§¦å‘åä¼šé€šçŸ¥è®¾ç½®è¯¥è§‚å¯Ÿçš„å®¢æˆ·ç«¯ï¼Œç„¶åæ¶ˆå¤±ã€‚</p><div class="note note-info">            <p>ğŸ’¡ ä¹Ÿå°±æ˜¯è¯´æ¯ä¸€ä¸ªè§‚å¯Ÿåªèƒ½è§¦å‘ä¸€æ¬¡ï¼Œå¦‚æœæƒ³è¦å¤šæ¬¡æ¥å—é€šçŸ¥ï¼Œéœ€è¦ä¸æ–­çš„è®¾ç½®è§‚å¯Ÿ</p>          </div><h3 id="æ“ä½œ"><a href="#æ“ä½œ" class="headerlink" title="æ“ä½œ"></a>æ“ä½œ</h3><p><img src="/2023/04/22/Zookeeper%E7%AE%80%E4%BB%8B/operation.png" alt="Operation list"></p><p>åœ¨æ›´æ–°ï¼ˆ <code>setData</code> , <code>delete</code> æ—¶éœ€è¦æä¾›ç‰ˆæœ¬å·ï¼Œå¯ä»¥ç”± <code>exists</code> æ–¹æ³•è·å–ï¼Œä¸”è¿™ä¸ªæ›´æ–°æ“ä½œæ˜¯éé˜»å¡çš„ï¼ˆå¯èƒ½åŒæ—¶ç”±å…¶ä»–çš„å®¢æˆ·ç«¯åœ¨æ›´æ–°ï¼‰</p><p>Zookeeper æä¾›äº†ä¸€ä¸ª multi çš„æ“ä½œï¼Œå¯ä»¥å°†å¤šä¸ªæ“ä½œæ‰“åŒ…ä¸ºä¸€ä¸ªåŸå­æ€§çš„æ“ä½œï¼Œä¸€èµ·æˆåŠŸä¸€èµ·å¤±è´¥</p><p>Zookeeper æä¾›äº†åŒæ­¥å’Œå¼‚æ­¥çš„APIï¼Œé€šå¸¸ä¼šä½¿ç”¨å¼‚æ­¥çš„APIä»¥æµæ°´çº¿çš„æ–¹å¼æ¥å¤„ç†è¯·æ±‚ã€‚</p><p><img src="/2023/04/22/Zookeeper%E7%AE%80%E4%BB%8B/znode_watcher.png" alt="è¿™ä¸ªè¡¨æä¾›äº†ä»€ä¹ˆæ“ä½œçš„å¯ä»¥å¯¹ znode è®¾ç½®è§‚å¯Ÿï¼Œä»¥åŠä»–ä»¬æ˜¯æ€ä¹ˆè¢«å‡ºå‘çš„"></p><p>è¿™ä¸ªè¡¨æä¾›äº†ä»€ä¹ˆæ“ä½œçš„å¯ä»¥å¯¹ znode è®¾ç½®è§‚å¯Ÿï¼Œä»¥åŠä»–ä»¬æ˜¯æ€ä¹ˆè¢«å‡ºå‘çš„</p><p>Zookeeper è¿˜æä¾›äº†æƒé™ç®¡ç†çš„åŠŸèƒ½ï¼Œç”¨æˆ·ç™»å½•éœ€è¦é€šè¿‡èº«ä»½éªŒè¯ï¼ˆIPï¼Œæˆ–è€…å¯†ç ç»„åˆç­‰æ–¹å¼ï¼‰æ¥è·å–è‡ªå·±çš„ ACL (Access Control List) </p><h3 id="å®ç°"><a href="#å®ç°" class="headerlink" title="å®ç°"></a>å®ç°</h3><p>æœ‰ä¸¤ç§æ¨¡å¼ï¼šstandaloneï¼ˆå•æœºï¼‰ã€replicated</p><p>åœ¨å¤åˆ¶æ¨¡å¼å…ˆï¼Œéœ€è¦é›†ç¾¤ä¸­æœ‰è¶…è¿‡ä¸€åŠçš„æœºå™¨å¯ç”¨ï¼Œæ‰€ä»¥ä¸€èˆ¬ Zookeeper é›†ç¾¤ä¸­æ€»æ˜¯æœ‰å•æ•°å°æœºå™¨ï¼ˆæ¯”å¦‚5å°-å®¹å¿2å°å®•æœºï¼Œä½†æ˜¯ 6å°æœåŠ¡å™¨åŒæ ·åªèƒ½å®¹å¿2å°å®•æœºï¼‰</p><p>ä¸€èˆ¬æœ‰ä¸¤ä¸ªé˜¶æ®µ</p><ol><li>é¢†å¯¼è€…é€‰ä¸¾ï¼šé€‰å‡ºä¸€å°ä¿æŒæœ€æ–°çŠ¶æ€çš„ leaderï¼Œå…¶ä»–äººæˆä¸º follower</li><li>åŸå­å¹¿æ’­ï¼šæ‰€æœ‰å¯¹äº znode çš„æ›´æ”¹éƒ½ä¼šç°åœ¨ leader ä¸­æ›´æ”¹å¹¶æŒä¹…åŒ–ï¼Œç„¶å leader æ‰å›å¹¿æ’­è¿™ä¸ªä¿®æ”¹ï¼Œè€Œä¸”è¿™ä¸ªè¾¾æˆåè®®çš„è¿‡ç¨‹å¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½æ˜¯åŸå­æ€§çš„ã€‚</li><li>ä¸€æ—¦é¢†å¯¼è€…å‡ºç°é—®é¢˜ï¼Œä¼šå¿«é€Ÿå†é€‰é€‰ä¸¾ä¸€ä¸ªé¢†å¯¼è€…ï¼Œç„¶åæ¢å¤æ­£å¸¸çš„åŸ leader ä¼šè‡ªåŠ¨ä¸å˜ä¸º follower</li></ol><h3 id="ä¸€è‡´æ€§"><a href="#ä¸€è‡´æ€§" class="headerlink" title="ä¸€è‡´æ€§"></a>ä¸€è‡´æ€§</h3><p>ä¸€ä¸ª follower å¯èƒ½è½å leader æ•°ä¸ªç‰ˆæœ¬ï¼Œå¯ä»¥é€šè¿‡ <code>sync()</code> å‡½æ•°å®Œæˆä¸€è‡´æ€§æ›´æ–°ã€‚</p><p>æ¯ä¸ª Client å¹¶ä¸çŸ¥é“è‡ªå·±è¿æ¥åˆ°çš„æ˜¯ follower è¿˜æ˜¯ leaderï¼Œä½†æ˜¯åªæœ‰ä»–é‡æ–°è¿æ¥ï¼Œä»–å°±ä¸ä¼šè¿æ¥åˆ°æ¯”è‡ªå·±åŸå…ˆæ›´è€çš„æœåŠ¡å™¨ç‰ˆæœ¬ï¼Œè¿™ä¸€ç‚¹æœ‰ znode é¡ºåºå·è¿›è¡Œä¿è¯ã€‚</p><p>é¡ºåºä¸€è‡´æ€§ã€æ“ä½œåŸå­æ€§ã€æ›´æ–°æŒä¹…æ€§ç­‰å‡å¯ä»¥å®ç°å¯¹äº Zookeeper çš„ä¸€è‡´æ€§ä¿è¯</p><h3 id="ä¼šè¯"><a href="#ä¼šè¯" class="headerlink" title="ä¼šè¯"></a>ä¼šè¯</h3><p>å®¢æˆ·ç«¯ä¸€æ—¦ä¸ä¸€ä¸ª Zookeeper æœåŠ¡å™¨å»ºç«‹è¿æ¥å°±äº§ç”Ÿäº†ä¸€ä¸ª Sessionï¼Œå®¢æˆ·ç«¯å¯ä»¥å®šæœŸå‘é€ ping ä¿¡å·æ¥ä¿è¯ session ä¸è¿‡æœŸ</p><div class="note note-primary">            <p>ğŸ’¡ session è¿æ¥çš„ Zookeeper æœåŠ¡å™¨æ•…éšœåï¼ŒZookeeper ä¿è¯äº†å¯¹äºæœåŠ¡å™¨çš„è‡ªåŠ¨åˆ‡æ¢ï¼Œæ‰€æœ‰ä¸æ•…éšœæœåŠ¡å™¨ç›¸å…³çš„ session åœ¨åˆ‡æ¢åä»ç„¶æ˜¯æœ‰æ•ˆçš„ï¼Œè¿™ä¸ªåˆ‡æ¢è¿‡ç¨‹å¯¹äºç”¨æˆ·æ˜¯é€æ˜çš„</p>          </div><p>ping çš„æ—¶é—´é€šå¸¸ä¼šè®¾ç½®ä¸º 2~20 ä¸ª tickï¼Œtickä¸€èˆ¬ä¸º 2s</p><p>é€šå¸¸æ¥è¯´ï¼ŒæœåŠ¡å™¨è¶Šå¤šï¼Œæ„å»ºçš„æš‚æ—¶çŠ¶æ€è¶Šå¤æ‚ï¼Œè¶Šåº”è¯¥è®¾ç½®è¾ƒé•¿çš„ ping æ—¶é—´</p><h3 id="çŠ¶æ€"><a href="#çŠ¶æ€" class="headerlink" title="çŠ¶æ€"></a>çŠ¶æ€</h3><p>çŠ¶æ€å›¾å¦‚ä¸‹ï¼Œä¸€ä¸ª Zookeeper å¯¹è±¡åªèƒ½å‡ºäºä¸€ç§çŠ¶æ€ï¼ŒåŒæ—¶çŠ¶æ€çš„åˆ‡æ¢ä¼šå‡ºå‘ watcher</p><p><img src="/2023/04/22/Zookeeper%E7%AE%80%E4%BB%8B/states.png" alt="States"></p><h2 id="Zookeeper-æ„å»ºåº”ç”¨"><a href="#Zookeeper-æ„å»ºåº”ç”¨" class="headerlink" title="Zookeeper æ„å»ºåº”ç”¨"></a>Zookeeper æ„å»ºåº”ç”¨</h2><h3 id="é…ç½®æœåŠ¡"><a href="#é…ç½®æœåŠ¡" class="headerlink" title="é…ç½®æœåŠ¡"></a>é…ç½®æœåŠ¡</h3><p>Zookeeper å¯ä»¥ä½œä¸ºä¸€ä¸ªé«˜å¯ç”¨çš„é…ç½®å­˜å‚¨å™¨ï¼Œå…è®¸åˆ†å¸ƒå¼åº”ç”¨çš„å‚ä¸è€…æ£€ç´¢å’Œæ›´æ–°é…ç½®æ–‡ä»¶</p><p>å¯ä»¥åˆ©ç”¨ znode ä»¥é”®å€¼å¯¹çš„æ–¹å¼å­˜å‚¨é…ç½®ï¼Œå¹¶æä¾›å¤šç§å±‚çº§çš„æ”¯æŒ</p><p>åˆ©ç”¨ Watcher è§‚å¯Ÿ <code>NodeDataChanged</code> äº‹ä»¶æ¥åœ¨ä¸åŒçš„å®¢æˆ·ç«¯ä¸­åŒæ­¥é…ç½®</p><h3 id="å¯å¤åŸçš„-Zookeeper-åº”ç”¨"><a href="#å¯å¤åŸçš„-Zookeeper-åº”ç”¨" class="headerlink" title="å¯å¤åŸçš„ Zookeeper åº”ç”¨"></a>å¯å¤åŸçš„ Zookeeper åº”ç”¨</h3><p>æ•æ‰ <code>KeeperException</code> ï¼Œå¹¶æ ¹æ®å…¶ç±»åˆ«æ¥å¯¹åº”ç”¨è¿›è¡Œæ¢å¤</p><p>è¦æ³¨æ„å¹‚ç­‰å’Œéå¹‚ç­‰æ“ä½œçš„åŒºåˆ«ï¼Œå¹‚ç­‰æ“ä½œå¯ä»¥å¤šæ¬¡é‡å¤ï¼Œè€Œéå¹‚ç­‰æ“ä½œå•§ä¸èƒ½ç›²ç›®çš„é‡è¯•</p><h3 id="åˆ†å¸ƒå¼é”"><a href="#åˆ†å¸ƒå¼é”" class="headerlink" title="åˆ†å¸ƒå¼é”"></a>åˆ†å¸ƒå¼é”</h3><p>æä¾›ä¸€ç»„è¿›ç¨‹é—´çš„äº’æ–¥æœºåˆ¶ï¼Œå¯ä»¥ç”¨äºåœ¨å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿä¸­å®ç°é¢†å¯¼è€…é€‰ä¸¾ï¼ŒæŒæœ‰é”çš„è¿›ç¨‹å°±æ˜¯é¢†å¯¼è€…</p><p>æ€è·¯å¾ˆç®€å•ï¼Œåˆ›å»ºä¸€ä¸ªé”çš„ znodeï¼Œç„¶ååœ¨ä»–çš„ä¸‹é¢åˆ›å»ºä¸€äº›å­ znodeï¼Œå¦‚ <code>/leader/lock-1</code>, <code>/leader/lock-2,</code> ä»»ä½•æ—¶å€™é¡ºåºå°çš„æŒæœ‰é”</p><p>ç”³è¯·è·å–é”çš„ä¼ªä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-number">1.</span> Create an ephemeral sequential znode named lock- under the lock znode, and<br>remember its actual <span class="hljs-title function_">pathname</span> <span class="hljs-params">(the return value of the create operation)</span>.<br><span class="hljs-number">2.</span> Get the children of the lock znode and set a watch.<br><span class="hljs-number">3.</span> If the pathname of the znode created in step <span class="hljs-number">1</span> has the lowest number of the children<br>returned in step <span class="hljs-number">2</span>, then the lock has been acquired. Exit.<br><span class="hljs-number">4.</span> Wait <span class="hljs-keyword">for</span> the notification from the watch set in step <span class="hljs-number">2</span>, and go to step <span class="hljs-number">2.</span><br></code></pre></td></tr></table></figure><p>ä¸¤ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼š</p><p><strong><strong>ç¾Šç¾¤æ•ˆåº”</strong></strong></p><ul><li>è§£é‡Šï¼šæ¯ä¸ª client éƒ½ä¼šåœ¨é” znode ä¸Šæ”¾ç½®ä¸€ä¸ªè§‚å¯Ÿï¼Œæ¯æ¬¡çŠ¶æ€å˜åŒ–æ—¶ä¼šå¯èƒ½ä¼šæœ‰å¤§é‡çš„å®¢æˆ·ç«¯å—åˆ°åŒä¸€äº‹ä»¶çš„é€šçŸ¥ï¼Œä½†æ˜¯åªæœ‰å¾ˆå°‘ä¸€éƒ¨åˆ†éœ€è¦å¤„ç†è¿™ä¸ªäº‹ä»¶ï¼Œè¿™æ ·ä¼šé€ æˆç½‘ç»œå¸¦å®½çš„å³°å€¼å‹åŠ›è¿‡å¤§</li><li>è§£å†³ï¼šåªåœ¨å½“å‰å­èŠ‚ç‚¹æ¶ˆå¤±æ—¶ï¼Œé€šçŸ¥å…¶ä¸‹ä¸€ä¸ªå­èŠ‚ç‚¹</li></ul><p><strong><strong>å¯æ¢å¤å¼‚å¸¸</strong></strong></p><ul><li>æè¿°ï¼šåœ¨åˆ›å»ºé” znode æ—¶ï¼Œæˆ‘ä»¬ä¸èƒ½å¤„ç†ç”±äºè¿æ¥ä¸¢å¤±å¯¼è‡´çš„åˆ›å»ºå¤±è´¥ï¼ˆpartial failure)ã€‚æˆ‘ä»¬ä¸èƒ½ç®€å•çš„è¿›è¡Œé‡è¯•ï¼Œå¦åˆ™ä¼šå‡ºç°å­¤å„¿ znode</li><li>è§£å†³ï¼šåœ¨znodeä¸­åŠ å…¥ sessionIDï¼Œæ„æˆ <code>lock-&lt;sessionID&gt;-&lt;sequenceNumber&gt;</code> çš„åç§°åºåˆ—ï¼Œåœ¨é‡æ–°è¿æ¥æ—¶è¿›è¡Œæœç´¢ã€‚</li></ul><h2 id="ç”Ÿäº§ç¯å¢ƒ"><a href="#ç”Ÿäº§ç¯å¢ƒ" class="headerlink" title="ç”Ÿäº§ç¯å¢ƒ"></a>ç”Ÿäº§ç¯å¢ƒ</h2><p>è¿˜ä¼šå­˜åœ¨é™¤äº† leader å’Œ follower ä¹‹å¤–çš„è§’è‰²ï¼šobserverï¼Œæ˜¯æ²¡æœ‰æŠ•ç¥¨æƒçš„è·Ÿéšè€…ï¼Œå¯ä»¥å°† observer æ”¾ç½®åœ¨ä¸åŒäº leader å’Œ follower çš„æœºæ¶ä¸­ï¼Œè¿™æ ·æ—¢ä¸å½±å“æ€§èƒ½ï¼Œä¹Ÿèƒ½å¤Ÿæé«˜æ•´ä¸ª Zookeeper æœåŠ¡çš„å¯ç”¨æ€§</p><p>ä¸»è¦ä½¿ç”¨ 3 ä¸ªç«¯å£ï¼š</p><ul><li>2181ï¼šå®¢æˆ·ç«¯è¿æ¥</li><li>2888ï¼šå¯¹äº leader æ¥è¯´ï¼Œfollower ä»è¿™ä¸ªç«¯å£è¿›è¡Œè¿æ¥</li><li>3888ï¼šé¢†å¯¼è€…é€‰ä¸¾é˜¶æ®µçš„å…¶ä»–æœåŠ¡å™¨è¿æ¥</li></ul><p>åº”ç”¨ï¼š</p><ul><li>ä¸º HDFS çš„ Namenode æä¾›é«˜å¯ç”¨æ€§æ”¯æŒ</li><li>ä¸º Yarn çš„ resourcemanager æä¾›é«˜å¯ç”¨æ”¯æŒ</li></ul><p>ä¸»è¦æ˜¯å¿«é€Ÿçš„ä¸»å¤‡åˆ‡æ¢</p>]]></content>
    
    
    
    <tags>
      
      <tag>å¼•æ“åŸºç¡€</tag>
      
      <tag>Zookeeper</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HDFS I/O</title>
    <link href="/2023/04/01/HDFS-I-O/"/>
    <url>/2023/04/01/HDFS-I-O/</url>
    
    <content type="html"><![CDATA[<h2 id="æ•°æ®å®Œæ•´æ€§"><a href="#æ•°æ®å®Œæ•´æ€§" class="headerlink" title="æ•°æ®å®Œæ•´æ€§"></a>æ•°æ®å®Œæ•´æ€§</h2><p>HDFS é€šè¿‡æ ¡éªŒå’Œçš„è®¡ç®—æ¥ä¿è¯å®Œæ•´æ€§ï¼Œä¸€èˆ¬è®¤ä¸ºè®¡ç®—4ä¸ªå­—èŠ‚çš„æ ¡éªŒå’Œå¸¦æ¥çš„é¢å¤–çš„å­˜å‚¨ï¼ˆ1%ï¼‰å’Œè®¡ç®—å¼€é”€éƒ½æ˜¯å¯æ¥å—çš„</p><p>HDFS åœ¨ä»¥ä¸‹å‡ ä¸ªå±‚é¢ä¿éšœæ•°æ®å®Œæ•´æ€§ï¼š</p><ul><li>datanode åœ¨æ”¶åˆ°æ•°æ®åéªŒè¯ checksumï¼Œåœ¨æ•´ä¸ªå†™è¿‡ç¨‹çš„ pipeline çš„æœ€åä¸€ä¸ª datanode è´Ÿè´£æ ¡éªŒå’Œï¼Œè¿”å› IOException</li><li>è¯»å–æ—¶ä¹Ÿä¼šæ ¡éªŒ checksumï¼Œdatanode ä¼šç»´æŠ¤ä¸€ä¸ª checksum çš„æ£€æµ‹æ—¥å¿—ï¼Œæ¯ä¸€æ¬¡è¯»å–æ£€æŸ¥åæ›´æ–°æ£€æµ‹æ—¥å¿—</li><li>datanode çš„åå°çº¿ç¨‹ä¹Ÿä¼šå®šæœŸæ£€æŸ¥å­˜å‚¨åœ¨ datanode ä¸­çš„æ‰€æœ‰å—çš„ checksum</li></ul><p>å¤„ç†æŸåå—çš„æ–¹æ³•æ˜¯ç›´æ¥è¦†ç›–æˆ–è€…æŠŠå½“å‰è¿™ä¸ªdatanodeä¸­çš„å—æ”¾å¼ƒæ‰ï¼Œå°è¯•å°†æ•°æ®å¤åˆ¶åˆ°æ–°çš„datanode</p><p>åœ¨æœ¬åœ°ç³»ç»Ÿå¯ä»¥ä½¿ç”¨ <code>LocalFileSystem</code> å®ç°æ•°æ®å®Œæ•´æ€§çš„æ£€éªŒï¼ŒåŒæ—¶å¯ä»¥ç”¨ <code>ChecksumFileSystem</code> è¿›è¡Œå…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„å°è£…</p><h2 id="å‹ç¼©"><a href="#å‹ç¼©" class="headerlink" title="å‹ç¼©"></a>å‹ç¼©</h2><p>é›†ä¸­å¸¸è§å‹ç¼©çš„ä¼˜ç¼ºç‚¹ï¼š</p><ul><li>gzipï¼šDEFLATEç®—æ³•ï¼Œæ— æ³•åˆ‡åˆ†ï¼Œå‹ç¼©è§£å‹ç¼©é€Ÿåº¦æ¯”è¾ƒå¿«ï¼Œé€‚åˆä¸­é€”å°æ–‡ä»¶çš„ä¼ è¾“ï¼ˆmapè¿‡ç¨‹ä¸­ï¼‰</li><li>bzip2ï¼šå¯ä»¥åˆ‡åˆ†ï¼Œç”¨äºåˆ›å»ºmapä»»åŠ¡ï¼Œä½†æ˜¯å‹ç¼©è§£å‹é€Ÿåº¦æ…¢</li><li>lzoï¼šåœ¨æ„å»ºç´¢å¼•çš„æƒ…å†µä¸‹å¯åˆ‡åˆ†</li><li>snappyï¼šä¸å¯åˆ‡åˆ†ï¼Œä¹Ÿæ˜¯å¿«é€Ÿå‹ç¼©ç®—æ³•</li></ul><p>Hadoop å¯¹äºé›†ä¸­å¸¸ç”¨çš„å‹ç¼©ç®—æ³•éƒ½æœ‰å¯¹åº”çš„ Codec ç±»è¿›è¡Œå®ç°</p><h3 id="å‹ç¼©çš„ç¼–ç¨‹å®ç°"><a href="#å‹ç¼©çš„ç¼–ç¨‹å®ç°" class="headerlink" title="å‹ç¼©çš„ç¼–ç¨‹å®ç°"></a><strong>å‹ç¼©çš„ç¼–ç¨‹å®ç°</strong></h3><p>ä½¿ç”¨ codec å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">Class&lt;?&gt; codecClass = Class.forName(codecClassname);<br><span class="hljs-type">Configuration</span> <span class="hljs-variable">conf</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Configuration</span>();<br><span class="hljs-type">CompressionCodec</span> <span class="hljs-variable">codec</span> <span class="hljs-operator">=</span> (CompressionCodec)<br>ReflectionUtils.newInstance(codecClass, conf);<br><span class="hljs-comment">// ä¸‹é¢è¿™ä¸ªå®é™…ä¸Šå°±æ˜¯å¯¹ OutputStream è¿›è¡Œå°è£…ï¼Œæ˜¾ç„¶æ¢æˆ FSDataOutputStream ä¹Ÿå¯</span><br><span class="hljs-type">CompressionOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> codec.createOutputStream(System.out);<br>codec.createOutputStream(OutStream out);<br></code></pre></td></tr></table></figure><p>ä¸Šæ–‡çš„é€šè¿‡åå°„çš„å®ä¾‹æ„å»ºä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ªå·¥å‚ç±»æ¥å®ç° <code>CompressionCodecFactory.getCodec()</code> ï¼Œé€šè¿‡æ–‡ä»¶çš„åç¼€åæ¥æ¨æ–­å‹ç¼©ç±»å‹</p><div class="note note-primary">            <p>ğŸ’¡ åœ¨å‹ç¼©è§£å‹çš„è¿‡ç¨‹ä¸­ç›´æ¥è°ƒç”¨åŸç”Ÿï¼ˆnativeï¼‰ä»£ç åº“å¯ä»¥æ˜¾è‘—æå‡é€Ÿåº¦</p>          </div><p>åœ¨éœ€è¦æ‰§è¡Œå¤§é‡å‹ç¼©è§£å‹ç¼©çš„è¿‡ç¨‹æ—¶ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>CodecPool</code></p><h3 id="MapReduce-ä¸­çš„å‹ç¼©"><a href="#MapReduce-ä¸­çš„å‹ç¼©" class="headerlink" title="MapReduce ä¸­çš„å‹ç¼©"></a>MapReduce ä¸­çš„å‹ç¼©</h3><div class="note note-primary">            <p>ğŸ’¡ å‹ç¼©æ ¼å¼çš„é€‰æ‹©ï¼šå°½é‡é€‰æ‹©å¯åˆ‡åˆ†çš„å‹ç¼©æ ¼å¼ï¼Œæˆ–è€…åœ¨å‹ç¼©å‰è¿›è¡Œåˆ‡åˆ†ï¼Œç„¶ååˆ†åˆ«å‹ç¼©ï¼Œä¿è¯åˆ‡åˆ†çš„ç»“æœè¿‘ä¼¼åœ°ç­‰äºHDFSå—çš„å¤§å°</p>          </div><p>é€šè¿‡ä»¥ä¸‹æ–¹æ³•åœ¨ job çš„ output ä¸­ç›´æ¥é›†æˆå‹ç¼©ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">FileOutputFormat.setCompressOutput(job, <span class="hljs-literal">true</span>);<br>FileOutputFormat.setOutputCompressorClass(job, GzipCodec.class);<br></code></pre></td></tr></table></figure><p>åŒæ—¶å¯ä»¥é€šè¿‡ config æ¥è®¾ç½®æ˜¯å¦åœ¨ map çš„ä¸­é—´ç»“æœä¸­ä½¿ç”¨å‹ç¼©ï¼Œä»¥è·å–è¿›ä¸€æ­¥çš„æ€§èƒ½æå‡</p><h2 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h2><p>åºåˆ—åŒ–ç”¨äºåˆ†å¸ƒå¼æ•°æ®å¤„ç†çš„ä¸¤å¤§å¦ä¸€ï¼šè¿›ç¨‹é—´é€šä¿¡å’Œæ°¸ä¹…å­˜å‚¨</p><p>åºåˆ—åŒ–éœ€è¦çš„ç‰¹ç‚¹ï¼šç´§å‡‘ï¼ˆèŠ‚çœå¸¦å®½ï¼‰ï¼Œå¿«é€Ÿï¼ˆå¤ç”¨æ¬¡æ•°é«˜ï¼‰ã€å¯æ‹“å±•ï¼ˆæ€»ä¼šæœ‰æ–°çš„éœ€æ±‚ï¼‰ã€æ”¯æŒäº’æ“ä½œï¼ˆä¸åŒç«¯çš„äº¤äº’ï¼‰</p><h3 id="Writable"><a href="#Writable" class="headerlink" title="Writable"></a>Writable</h3><p>Hadoopçš„åºåˆ—åŒ–é€šè¿‡ Writable æ¥å£å®ç°ï¼Œç„¶å Writable æ¥å£æœ‰è¡ç”Ÿå‡ºæ¥åˆ†åˆ«å¯¹åº”äº†ä¸åŒçš„ java æ•°æ®ç±»å‹çš„ Writable ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Writable</span> &#123;<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">write</span><span class="hljs-params">(DataOutput out)</span> <span class="hljs-keyword">throws</span> IOException;<br><span class="hljs-keyword">void</span> <span class="hljs-title function_">readFields</span><span class="hljs-params">(DataInput in)</span> <span class="hljs-keyword">throws</span> IOException;<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ <code>DataOutput</code> å’Œ <code>DataInput</code> æ˜¯ <a href="http://java.io/">java.io</a> ä¸­çš„ä¸¤ä¸ªæ¥å£ï¼Œå…¶å®ç°åˆ†åˆ«æ˜¯ <code>DataOutputStream</code> å’Œ <code>DataInputStream</code> </p><p><code>WritableComparable</code> ç”±å…¶åå­—å¯ä»¥çœ‹å‡ºï¼Œåˆ†åˆ«å®ç°äº†<code>Writable</code> å’Œ <code>Comparable</code> è¿™ä¸¤ä¸ªæ¥å£ï¼Œå¯¹åº”çš„ <code>WritableComparator</code> åˆ™ç¨æœ‰ä¸åŒï¼Œè¿™ä¸ªç±»åœ¨å…·ä½“å®ç°çš„åŒæ—¶ï¼Œè¿˜å……å½“äº†ä¸€ä¸ªå·¥å‚ç±»çš„è§’è‰²ï¼Œç”Ÿæˆä¸åŒç±»å‹çš„ <code>RawComparator</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">RawComparator&lt;IntWritable&gt; comparator = WritableComparator.get(IntWritable.class);<br></code></pre></td></tr></table></figure><ul><li><p>ä¸‹é¢å¯ä»¥å»çœ‹ä¸€ä¸‹ <code>WritableComparator</code> è¿™ä¸ªç±»çš„æºç ï¼Œå› ä¸ºåé¢å¯¹äº <code>TextPair</code> çš„ <code>comparator</code> çš„æ„å»ºè¦ç”¨åˆ°è¿™ä¸ªç±»</p></li><li><p>ä¸‹é¢æ˜¯ä¸€ä¸ªHadoop Writable çš„ç»§æ‰¿å…³ç³»å›¾ï¼šå€¼å¾—æ³¨æ„çš„æ˜¯ int å’Œ long å¯¹åº”çš„ Writable æœ‰å˜é•¿ç‰ˆæœ¬ï¼Œä¸€èˆ¬ä¼šä½¿ç”¨å˜é•¿ç‰ˆæœ¬çš„ï¼Œè¿™æ ·æ¯”è¾ƒèŠ‚çœç©ºé—´</p><p>  <img src="/2023/04/01/HDFS-I-O/Writable.png" alt="Writable ç±»å›¾"></p></li></ul><p><code>Text</code> ç±»å‹ç›¸å½“äº <code>String</code> ä½†æ˜¯åœ¨ç´¢å¼•ä¸Šåˆæœ‰æ‰€ä¸åŒï¼ŒText çš„é•¿åº¦æ˜¯æŒ‰ç…§ Byte è¿›è¡Œè®¡ç®—çš„ï¼Œç´¢å¼•(<code>charAt()</code>)ä¹Ÿå¤§å¤šä¼šç´¢å¼•åˆ° byteã€‚<code>Text</code> çš„è¿™ç§ç‰¹æ€§ä¹Ÿä½¿å¾—å…¶éå†ç›¸å½“éº»çƒ¦ï¼Œéœ€è¦ç”¨å¦‚ä¸‹ä¸€ä¸ªåˆ©ç”¨ <code>ByteBuffer</code> è¿›è¡Œè½¬æ¢çš„æ–¹æ³•éå†æ¯ä¸€ä¸ªå­—ç¬¦ï¼Œå½“ç„¶ç›´æ¥è°ƒç”¨ <code>toString()</code> æ–¹æ³•å¯èƒ½æ˜¯æ›´æ–¹ä¾¿çš„æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TextIterator</span> &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br><span class="hljs-type">Text</span> <span class="hljs-variable">t</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Text</span>(<span class="hljs-string">&quot;\u0041\u00DF\u6771\uD801\uDC00&quot;</span>);<br><span class="hljs-type">ByteBuffer</span> <span class="hljs-variable">buf</span> <span class="hljs-operator">=</span> ByteBuffer.wrap(t.getBytes(), <span class="hljs-number">0</span>, t.getLength());<br><span class="hljs-type">int</span> cp;<br><span class="hljs-keyword">while</span> (buf.hasRemaining() &amp;&amp; (cp = Text.bytesToCodePoint(buf)) != -<span class="hljs-number">1</span>) &#123;<br>System.out.println(Integer.toHexString(cp));<br>&#125;<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>â“ é‚£ä»€ä¹ˆæ—¶å€™åªèƒ½å¯¹ <code>Text</code> è¿›è¡Œæ“ä½œå‘¢ï¼Œä¸€è¡Œç‰¹åˆ«é•¿å—ï¼Ÿä½†æ˜¯è¿™æ ·çš„æƒ…å†µåœ¨è¯»å–çš„æ—¶å€™ä¸ä¼šæœ‰å¤„ç†å—ï¼Œæ¯”å¦‚ä¸€ä¸ªå—å…¶å®ä¹Ÿå°±128Mï¼Œè¿™128Mä¹Ÿä¸ä¼šä¸€æ¬¡ç›´æ¥å…¨è¯»æˆ <code>Text</code></p>          </div><p><code>NullWritable</code> åœ¨ MapReduce è¿‡ç¨‹ä¸­ä¸éœ€è¦æŸä¸€ä¸ª value æ—¶å¯ä»¥å£°æ˜ï¼Œå¯ä»¥é«˜æ•ˆå­˜å‚¨ç©ºå€¼ï¼ŒèŠ‚çœå¸¦å®½</p><div class="note note-primary">            <p>â“ ä¸€ä¸ªä¸å¤ªé‡è¦çš„å°é—®é¢˜ï¼šObjectWritable å’Œ GenericWritable çš„åŒºåˆ«ï¼Ÿ ä¹¦ä¸Šç»™å‡ºçš„äº‹ GenericWritable ä½¿ç”¨é™æ€ç±»å‹çš„æ•°ç»„å¹¶åŠ å…¥ç´¢å¼•ä»¥æé«˜æ€§èƒ½ã€‚</p>          </div><h3 id="Writable-çš„å®šåˆ¶åŒ–"><a href="#Writable-çš„å®šåˆ¶åŒ–" class="headerlink" title="Writable çš„å®šåˆ¶åŒ–"></a>Writable çš„å®šåˆ¶åŒ–</h3><p>å¦‚æœæˆ‘ä»¬å¸Œæœ›é’ˆå¯¹ä¸€ä¸ª Hadoop æ²¡æœ‰å®ç°çš„æ•°æ®ç»“æ„å®ç°åœ¨ Hadoop ä¸Šçš„åºåˆ—åŒ–ï¼Œæˆ‘ä»¬æœ€å¥½çš„æ–¹æ³•æ˜¯æ–°å»ºä¸€ä¸ªæ–°çš„ Writable ç±»å‹</p><p>åœ¨æ–°å»º Writable ç±»å‹åï¼Œæˆ‘ä»¬å¾€å¾€ä¸ºäº†é¿å…åœ¨æ¯”è¾ƒè¿‡ç¨‹ä¸­éœ€è¦å°†å¯¹è±¡è¿›è¡Œååºåˆ—åŒ–ï¼Œéœ€è¦é‡æ–°å†™ä¸€ä¸ª RawComparator æƒ³åŠæ³•åœ¨å­—èŠ‚å±‚é¢ä¸Šå¯¹å¯¹è±¡è¿›è¡Œæ¯”è¾ƒ</p><p>Serialization æ˜¯ä¸€ä¸ªæ¯” Writable æ›´å¤§çš„èŒƒç•´ï¼ŒHadoop ä¹Ÿæä¾›äº†ä¸€ä¸ªé™¤äº†åŒ…å« Writable çš„æ›´ general çš„ frameworkï¼Œé™¤æ­¤ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨åˆ«çš„ï¼Œæ¯”å¦‚ Avro</p><h2 id="SequenceFile"><a href="#SequenceFile" class="headerlink" title="SequenceFile"></a>SequenceFile</h2><p>SequenceFile è®¾è®¡å‡ºæ¥æœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼š</p><ul><li>ä¸€æ–¹é¢å¯ä»¥æä¾›ä¸€ä¸ªäºŒè¿›åˆ¶çš„é”®å€¼å¯¹å­˜å‚¨ç»“æ„</li><li>å¦å¤–ä¸€æ–¹é¢å¯ä»¥ä½œä¸ºå°æ–‡ä»¶çš„å®¹å™¨å¯¹å°æ–‡ä»¶è¿›è¡ŒåŒ…è£…(why?)</li></ul><div class="note note-primary">            <p>ğŸ’¡ é€šå¸¸è§£å†³â€å°æ–‡ä»¶é—®é¢˜â€çš„å›åº”æ˜¯ï¼šä½¿ç”¨ SequenceFileã€‚è¿™ç§æ–¹æ³•çš„æ€è·¯æ˜¯ï¼Œä½¿ç”¨æ–‡ä»¶åä½œä¸º keyï¼Œ æ–‡ä»¶å†…å®¹ä½œä¸º value<br>åœ¨å®è·µä¸­è¿™ç§æ–¹å¼éå¸¸æœ‰æ•ˆã€‚æˆ‘ä»¬å›åˆ°10,000ä¸ª100KBå¤§å°çš„å°æ–‡ä»¶é—®é¢˜ä¸Šï¼Œä½ å¯ä»¥ç¼–å†™ä¸€ä¸ªç¨‹åº å°†åˆå¹¶ä¸ºä¸€ä¸ª SequenceFileï¼Œç„¶åä½ å¯ä»¥ä»¥æµå¼æ–¹å¼å¤„ç†(ç›´æ¥å¤„ç†æˆ–ä½¿ç”¨ MapReduce) SequenceFileã€‚è¿™æ ·ä¼šå¸¦æ¥ä¸¤ä¸ªä¼˜åŠ¿ï¼š<br>SequenceFiles æ˜¯å¯æ‹†åˆ†çš„ï¼Œå› æ­¤ MapReduce å¯ä»¥å°†å®ƒä»¬åˆ†æˆå—ï¼Œåˆ†åˆ«å¯¹æ¯ä¸ªå—è¿›è¡Œæ“ä½œï¼›<br>ä¸ HAR ä¸åŒï¼Œå®ƒä»¬æ”¯æŒå‹ç¼©ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå—å‹ç¼©æ˜¯æœ€å¥½çš„é€‰æ‹©ï¼Œå› ä¸ºå®ƒç›´æ¥å¯¹å‡ ä¸ªè®°å½•ç»„ æˆçš„å—è¿›è¡Œå‹ç¼©ï¼Œè€Œä¸æ˜¯å¯¹æ¯ä¸€ä¸ªè®°å½•è¿›è¡Œå‹ç¼©ã€‚<br>å°†ç°æœ‰æ•°æ®è½¬æ¢ä¸º SequenceFile å¯èƒ½ä¼šå¾ˆæ…¢ã€‚ä½†æ˜¯ï¼Œå®Œå…¨å¯ä»¥å¹¶è¡Œåˆ›å»ºä¸€ä¸ªä¸€ä¸ªçš„ SequenceFile æ–‡ä»¶ã€‚ Stuart Sierra å†™äº†ä¸€ç¯‡å…³äºå°† tar æ–‡ä»¶è½¬æ¢ä¸º SequenceFile çš„æ–‡ç« ï¼Œåƒè¿™æ ·çš„å·¥å…·æ˜¯éå¸¸ æœ‰ç”¨çš„ï¼Œæˆ‘ä»¬åº”è¯¥å¤šçœ‹çœ‹ã€‚å‘å‰çœ‹ï¼Œæœ€å¥½è®¾è®¡å¥½æ•°æ®ç®¡é“ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼Œå°†æºæ•°æ®ç›´æ¥å†™å…¥ SequenceFile ï¼Œè€Œä¸æ˜¯ä½œä¸ºä¸­é—´æ­¥éª¤å†™å…¥å°æ–‡ä»¶ã€‚<br>ä¸ HAR æ–‡ä»¶ä¸åŒï¼Œæ²¡æœ‰åŠæ³•åˆ—å‡º SequenceFile ä¸­çš„æ‰€æœ‰é”®ï¼Œæ‰€ä»¥ä¸èƒ½è¯»å–æ•´ä¸ªæ–‡ä»¶ã€‚ Map Fileï¼Œ ç±»ä¼¼äºå¯¹é”®è¿›è¡Œæ’åºçš„ SequenceFileï¼Œç»´æŠ¤éƒ¨åˆ†ç´¢å¼•ï¼Œæ‰€ä»¥ä»–ä»¬ä¹Ÿä¸èƒ½åˆ—å‡ºæ‰€æœ‰çš„é”®<br>åŸæ–‡é“¾æ¥ï¼š<a href="https://blog.csdn.net/qq_43061290/article/details/124822293">https://blog.csdn.net/qq_43061290&#x2F;article&#x2F;details&#x2F;124822293</a></p>          </div><h3 id="è¯»å†™æ“ä½œ"><a href="#è¯»å†™æ“ä½œ" class="headerlink" title="è¯»å†™æ“ä½œ"></a>è¯»å†™æ“ä½œ</h3><p><strong>è¯»</strong></p><p>readerå¯ä»¥ç›´æ¥å®ä¾‹åŒ–ï¼Œç„¶åé€šè¿‡ <code>next()</code> å’Œ <code>getCurrentValue()</code> æ¥è¯»å–</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>reader = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SequenceFile</span>.Reader(fs, path, conf);<br><span class="hljs-type">Writable</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> (Writable)<br>ReflectionUtils.newInstance(reader.getKeyClass(), conf);<br><span class="hljs-type">Writable</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> (Writable)<br>ReflectionUtils.newInstance(reader.getValueClass(), conf);<br><span class="hljs-type">long</span> <span class="hljs-variable">position</span> <span class="hljs-operator">=</span> reader.getPosition();<br><span class="hljs-keyword">while</span> (reader.next(key, value)) &#123;<br><span class="hljs-type">String</span> <span class="hljs-variable">syncSeen</span> <span class="hljs-operator">=</span> reader.syncSeen() ? <span class="hljs-string">&quot;*&quot;</span> : <span class="hljs-string">&quot;&quot;</span>;<br>System.out.printf(<span class="hljs-string">&quot;[%s%s]\t%s\t%s\n&quot;</span>, position, syncSeen, key, value);<br>position = reader.getPosition(); <span class="hljs-comment">// beginning of next record</span><br>&#125;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>IOUtils.closeStream(reader);<br>&#125;<br></code></pre></td></tr></table></figure><div class="note note-primary">            <p>â“ è¿™é‡Œæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ä»£ç ä¸­æä¾›çš„è¯»å–æ–¹å¼å’Œä¹¦ä¸­æä¾›çš„API æ˜¯æœ‰ä¸€äº›å·®åˆ«çš„</p>          </div><p>è¿˜å¯ä»¥é€šè¿‡ <code>seek(int pos)</code> å‡½æ•°åœ¨é¡ºåºæ–‡ä»¶ä¸­è¿›è¡Œæœç´¢ï¼Œä½†æ˜¯è¿™ä¸ª pos å¦‚æœä¸æ˜¯è¾¹ç•Œå€¼çš„è¯ä¼šæŠ¥é”™</p><p>ä¹Ÿå¯ä»¥ç”¨ <code>sync(int pos)</code> æ–¹æ³•æ¥å¯»æ‰¾ä¸‹ä¸€ä¸ªåŒæ­¥ç‚¹ï¼Œè¿™ä¸ªåŒæ­¥ç‚¹æ˜¯ç”± Writer åœ¨å†™çš„è¿‡ç¨‹ä¸­åˆ›å»ºçš„</p><div class="note note-primary">            <p>ğŸ’¡ åŒæ­¥ç‚¹æä¾›åœ¨è¯»å–è¿‡ç¨‹ä¸­å› ä¸ºæœç´¢å¯¼è‡´æ–‡ä»¶æŒ‡é’ˆ lost åå¯ä»¥å¿«é€ŸåŒæ­¥</p>          </div><p> <strong>å†™</strong></p><p>é€šè¿‡ä¸€ä¸ªå¯ä»¥æ“ä½œå¤šç§æ•°æ®ç±»å‹çš„ <code>createWriter()</code> åˆ›å»ºä¸€ä¸ª writerï¼Œç„¶åç”¨ <code>append()</code> å‡½æ•°å‘å…¶ä¸­æ·»åŠ  key å’Œ value å³å¯ï¼ŒåŒæ—¶ writer ä¹Ÿæ˜¯ä¸€ä¸ª <code>Closable</code> æµï¼Œéœ€è¦ close</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">try</span> &#123;<br>writer = SequenceFile.createWriter(fs, conf, path,<br>key.getClass(), value.getClass());<br><span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) &#123;<br>key.set(<span class="hljs-number">100</span> - i);<br>value.set(DATA[i % DATA.length]);<br>System.out.printf(<span class="hljs-string">&quot;[%s]\t%s\t%s\n&quot;</span>, writer.getLength(), key, value);<br>writer.append(key, value);<br>&#125;<br>&#125; <span class="hljs-keyword">finally</span> &#123;<br>IOUtils.closeStream(writer);<br>&#125;<br></code></pre></td></tr></table></figure><p>writer ä¸­ key value çš„ç±»ä¸ä¸€å®šæ˜¯ <code>Writable</code> ï¼Œä½†æ˜¯è‡³å°‘åº”è¯¥å¯ä»¥è¢«åºåˆ—åŒ–</p><div class="note note-primary">            <p>ğŸ’¡ SequenceFile å¯ä»¥å¾ˆæ–¹ä¾¿ç”¨ mapreduce è¿›è¡Œæ’åºåˆå¹¶ï¼Œæˆ–è®¸ä¸ºç®¡ç†å°æ–‡ä»¶æä¾›äº†ä¸€äº›å¸®åŠ©ï¼Ÿ</p>          </div><h3 id="ç»“æ„"><a href="#ç»“æ„" class="headerlink" title="ç»“æ„"></a>ç»“æ„</h3><p>Record Compression ï¼ˆDefaultï¼‰</p><p><img src="/2023/04/01/HDFS-I-O/record_compression.png" alt="Record Compression"></p><p>Block Compression</p><p><img src="/2023/04/01/HDFS-I-O/block_compression.png" alt="Block Compression"></p><div class="note note-primary">            <p>â“ å¦å¤–ä¸€ä¸ªä¸å¤ªé‡è¦çš„é—®é¢˜ï¼Œæ€ä¹ˆä»å‹ç¼©çš„é‡Œé¢è¯»å–ä¸€æ¡è®°å½•</p>          </div><p>å—å‹ç¼©æ˜¯ç”¨è®°å½•ä¸­çš„ç›¸ä¼¼æ€§è¿›è¡Œå‹ç¼©çš„</p>]]></content>
    
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
      <tag>å¼•æ“åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Yarn ç®€ä»‹</title>
    <link href="/2023/03/17/YARN-%E7%AE%80%E4%BB%8B/"/>
    <url>/2023/03/17/YARN-%E7%AE%80%E4%BB%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="Yarnçš„è¿è¡Œæœºåˆ¶"><a href="#Yarnçš„è¿è¡Œæœºåˆ¶" class="headerlink" title="Yarnçš„è¿è¡Œæœºåˆ¶"></a>Yarnçš„è¿è¡Œæœºåˆ¶</h2><p><img src="/2023/03/17/YARN-%E7%AE%80%E4%BB%8B/yarn_arch.png" alt="Yarn çš„è¿è¡Œæœºåˆ¶"></p><p>Yarnä¸­ä¸‰ç±»é‡è¦å®ä½“</p><ul><li>resource managerï¼šç®¡ç†é›†ç¾¤ä¸Šèµ„æºä½¿ç”¨</li><li>node managerï¼šè¿è¡Œåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šï¼Œèƒ½å¤Ÿå¯åŠ¨å’Œç›‘æ§å®¹å™¨</li><li>Containerï¼šç”¨äºæ‰§è¡Œç‰¹å®šçš„åº”ç”¨ç¨‹åºï¼Œæœ‰ä¸€å®šçš„èµ„æºé™åˆ¶</li></ul><p>è¿è¡Œæµç¨‹ï¼š</p><ul><li>å®¢æˆ·ç«¯è”ç³» resource managerï¼Œè¦æ±‚å¯åŠ¨ä¸€ä¸ª application master è¿›ç¨‹</li><li>resource manager æ‰¾åˆ°ä¸€ä¸ªå¯ä»¥å¯åŠ¨ application master çš„ node managerï¼Œç„¶åå¯åŠ¨è¿™ä¸ªå®¹å™¨<ul><li>applicationè¿è¡Œèµ·æ¥åå¯èƒ½æ˜¯è¿”å›ä¸€ä¸ªè®¡ç®— application ç»™å®¢æˆ·ç«¯ï¼Œä¹Ÿå¯èƒ½æ˜¯æ‰§è¡Œåˆ†å¸ƒå¼è®¡ç®—â€”â€”ç”³è¯·èµ„æºã€åˆ›å»ºæ–°çš„ application å’Œå®¹å™¨</li></ul></li></ul><p>Yarn æœ¬èº«ä¸æä¾›é€šä¿¡æœºåˆ¶ï¼Œåªæ˜¯èµ„æºçš„ç”³è¯·åˆ†é…</p><p>ç”³è¯·åˆ†é…ä¸ºäº†èŠ‚çœå¸¦å®½è¿˜æ˜¯é‡‡ç”¨äº†åœ¨ç½‘ç»œæ‹“æ‰‘ä¸Šçš„å°±è¿‘ï¼ˆèŠ‚ç‚¹â€”â€”æœºæ¶â€”â€”anyï¼‰</p><p>æŒ‰ç…§ç”¨æˆ·å’Œapplicationä¹‹é—´æ¥åˆ†ç±»</p><ul><li>ä¸€ä¸ªç”¨æˆ·ä½œä¸šå¯¹åº”ä¸€ä¸ªapplicationï¼šMapReduce</li><li>ç”¨æˆ·ä½œä¸šä¸­çš„ä¸€ä¸ªå·¥ä½œæµå¯¹åº”ä¸€ä¸ªapplicationï¼šSpark</li><li>å¤šä¸ªä¹Ÿç”¨æˆ·å¯¹ä¸€ä¸ª applicationï¼š Slider</li></ul><div class="note note-primary">            <p>ğŸ”´ å…¶å®å°±æ˜¯ï¼šä¸€å¯¹ä¸€ï¼Œä¸€å¯¹å¤šï¼Œå¤šå¯¹ä¸€</p>          </div><h2 id="Yarnçš„ä¼˜åŠ¿"><a href="#Yarnçš„ä¼˜åŠ¿" class="headerlink" title="Yarnçš„ä¼˜åŠ¿"></a>Yarnçš„ä¼˜åŠ¿</h2><ul><li>Scalabilityï¼šYarnä¸­å¯¹äºjobtracker çš„èµ„æºè°ƒåº¦å’Œä»»åŠ¡ç›‘æ§çš„èŒè´£åˆ†ç¦»å¸¦æ¥çš„å¥½å¤„</li><li>Availabilityï¼šåŒæ ·æ˜¯èŒè´£åˆ†ç¦»ï¼Œresource manager å’Œ application master å¯ä»¥åˆ†åˆ«åšé«˜å¯ç”¨</li><li>Utilization: Yarn å¯¹äºèµ„æºçš„ç®¡ç†æ›´ç²¾ç»†ï¼Œslotæ¯”è¾ƒå¤§</li><li>Multitenancyï¼šYarn å¯ä»¥ä¸ºæ›´å¤šçš„åº”ç”¨æä¾›æœåŠ¡ï¼ŒMapReduceä»…æ˜¯æœŸä¸­çš„ä¸€ä¸ª</li></ul><h2 id="Yarnçš„è°ƒåº¦"><a href="#Yarnçš„è°ƒåº¦" class="headerlink" title="Yarnçš„è°ƒåº¦"></a>Yarnçš„è°ƒåº¦</h2><p>ä¸‰ç§è°ƒåº¦å™¨ï¼š</p><ul><li><p>FIFOè°ƒåº¦å™¨ï¼šç®€å•ä¸ç”¨é…ç½®ï¼Œä¸é€‚åˆå…±äº«é›†ç¾¤ï¼Œæ¯ä¸ªä»»åŠ¡å¿…é¡»éƒ½èƒ½åˆ°è½®åˆ°è‡ªå·±æ‰è¡Œ</p>  <div class="note note-primary">            <p>æ„Ÿè§‰åŸºæœ¬ä¸Šåªé€‚åˆè‡ªå·±ç©ç©çš„æ—¶å€™ç”¨ï¼Œæˆ–è€…èµ„æºç‰¹åˆ«ä¸°ç››çš„æ—¶å€™ï¼Œæ¯ä¸ªäººå®é™…ä¸Šownäº†ä¸€ä¸ªé›†ç¾¤å¯ä»¥è‡ªå·±ç©     </p>          </div>   </li><li><p><strong>å®¹é‡è°ƒåº¦å™¨ï¼š</strong>æœ‰ä¸€ä¸ªç‹¬ç«‹çš„é˜Ÿåˆ—ä¿è¯å°ä½œä¸šçš„æäº¤å’Œå¯åŠ¨ï¼Œå¤§ä½œä¸šç­‰å¾…çš„æ—¶é—´ç›¸å¯¹é•¿ (default)</p></li><li><p>å…¬å¹³è°ƒåº¦å™¨ï¼šæ¯ä¸€ä¸ªç”¨æˆ·å¹³åˆ†æ‰€æœ‰èµ„æºï¼ˆåœ¨åŸæœ‰ä»»åŠ¡é‡Šæ”¾å‡ºæ¥åï¼‰ï¼Œæ¯ä¸€ä¸ªç”¨æˆ·çš„ä»»åŠ¡å†åˆ†åˆ«å¹³åˆ†è¿™ä¸ªç”¨æˆ·æ‹¥æœ‰çš„æ‰€æœ‰çš„èµ„æº</p></li></ul><p><strong>å®¹é‡è°ƒåº¦å™¨çš„é…ç½® <code>capacity-scheduler.xml</code>ï¼š</strong></p><p>å¯ä»¥é…ç½®æ¯ä¸€ä¸ªé˜Ÿåˆ—æ‹¥æœ‰çš„å›ºå®šçš„ capacityï¼ˆ%ï¼‰ å’Œç”¨äºå¼¹æ€§ä½¿ç”¨çš„ max capacityï¼ˆä¸è®¾ç½®é»˜è®¤å¯ä»¥å ç”¨å…¨éƒ¨çš„å®¹é‡ï¼‰, é˜Ÿåˆ—è¿˜å¯ä»¥é€šè¿‡ <code>a.b.queues</code> çš„æ–¹å¼å®šä¹‰å­é˜Ÿåˆ—</p><p>é€šè¿‡å±æ€§ <code>mapreduce.job.queuename</code> å†³å®šä»»åŠ¡æ¨é€çš„é˜Ÿåˆ—</p><p><strong>å…¬å¹³è°ƒåº¦å™¨çš„é…ç½® <code>fair-scheduler.xml</code>ï¼š</strong></p><ul><li><p>æƒé‡å…ƒç´ ï¼šå¯ä»¥è®¾ç½®å“ªä¸€ä¸ªé˜Ÿåˆ—çš„å æ¯”æ›´å¤§ï¼Œé€šè¿‡ <code>queue.weight</code> å±æ€§</p></li><li><p>è°ƒåº¦ç­–ç•¥ï¼šé»˜è®¤æ˜¯ fairï¼Œä¹Ÿå¯ä»¥æœ‰é˜Ÿåˆ—çº§çš„ fifoï¼ˆåªå¯¹è¯¥é˜Ÿåˆ—ä¸­çš„å„ä¸ªä»»åŠ¡ï¼‰ï¼ŒDRF (Dominant Resource Fairness, æ ¹æ®å ç”¨æœ€å¤šçš„èµ„æºè¿›è¡Œ fair è°ƒåº¦)</p></li><li><p>å¯ä»¥é€šè¿‡ <code>queuePlacementPolicy</code> è®¾ç½®é˜Ÿåˆ—æ”¾ç½®è§„åˆ™ï¼Œé»˜è®¤ä¼šæœ‰ â€œspecifiedâ€, â€œuserâ€, â€œprimaryGroupâ€, â€œdefaultâ€ ç­‰</p>  <div class="note note-primary">            <p>ğŸ’¡ å¦‚æœåªä½¿ç”¨ default åˆ™ç›¸å½“äºä¾¿æ·çš„å®ç°äº†å¯¹äºæ‰€æœ‰ä»»åŠ¡çš„å…¬å¹³è°ƒåº¦ï¼Œå› ä¸ºæ‰€æœ‰ä»»åŠ¡éƒ½ä¼šè¢«å¡è¿›ä¸€ä¸ªé˜Ÿåˆ—ä¸­</p>          </div></li><li><p>æŠ¢å ï¼šå…¬å¹³è°ƒåº¦å™¨å…è®¸æŠ¢å ï¼Œä½†æ˜¯æŠ¢å ä¼šé™ä½é›†ç¾¤çš„æ•ˆç‡</p></li></ul><p><strong><strong>å»¶è¿Ÿè°ƒåº¦</strong></strong></p><p>ä¸€ä¸ªéå¸¸trickyçš„è°ƒåº¦ç­–ç•¥ï¼šå¦‚æœè¯·æ±‚èŠ‚ç‚¹å®¹å™¨æ—¶å‘ç°æ²¡æœ‰ï¼Œå¯ä»¥ç­‰å¾…æ•°ç§’ï¼ˆæ•°ä¸ªheartbeatï¼ˆä¸€èˆ¬æ˜¯1sï¼‰ï¼‰ï¼Œè¿™æ ·å¯ä»¥æ˜¾è‘—æé«˜åœ¨å½“å‰èŠ‚ç‚¹è·å¾—ä¸€ä¸ªå®¹å™¨çš„æœºä¼šï¼Œè€Œä¸æ˜¯ä¸‹ä¸€çº§èŠ‚ç‚¹ï¼ˆèŠ‚ç‚¹â†’æœºæ¶â†’othersï¼‰</p><p>æ¯ä¸€ä¸ª heartbeat æ˜¯ä¸€ä¸ªæ½œåœ¨çš„è°ƒåº¦æœºä¼š</p>]]></content>
    
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
      <tag>å¼•æ“åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hadoop HDFS</title>
    <link href="/2023/03/07/Hadoop-HDFS/"/>
    <url>/2023/03/07/Hadoop-HDFS/</url>
    
    <content type="html"><![CDATA[<div class="note note-info">            <p>ã€ŠHadoop æƒå¨æŒ‡å—ã€‹è¯»ä¹¦ç¬”è®°</p>          </div><p>HDFSæ˜¯æµå¼è®¿é—®çš„ï¼šä¸€æ¬¡å†™å…¥ï¼Œå¤šæ¬¡è¯»å–ä¸”åªæ”¯æŒå•ä¸ªå†™å…¥è€…ï¼Œè€Œä¸”æ˜¯å¢é‡å†™å…¥çš„</p><h2 id="HDFSçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"><a href="#HDFSçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ" class="headerlink" title="HDFSçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ"></a>HDFSçš„å‡ ä¸ªåŸºæœ¬æ¦‚å¿µ</h2><ul><li>æ•°æ®å—ï¼šé»˜è®¤ä¸º128MB</li></ul><div class="note note-primary">            <p>ğŸ’¡ è¿™ä¸ª128MBä¸ç£ç›˜çš„ä¼ è¾“é€Ÿç‡æ˜¯åŒ¹é…çš„ï¼Œå¦‚æœä¼ è¾“é€Ÿç‡æé«˜ï¼Œé‚£ä¹ˆå°±å¯ä»¥æœ‰æ›´å¤§çš„ block å¤§å°</p>          </div><ul><li>namenode å’Œ datanode<ul><li>namenodeï¼šç»´æŠ¤æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ï¼ˆæ ‘ï¼‰ï¼šæ°¸ä¹…ä¿å­˜åœ¨æœ¬åœ°ç£ç›˜</li><li>datanodeï¼šå‚¨å­˜å¹¶æ£€ç´¢ blocksï¼Œå®šæœŸå‘ namenode æŠ¥å‘Šå‚¨å­˜çš„ block åˆ—è¡¨</li><li>ä¸¤ç§å®¹é”™æ–¹æ³•ï¼šå¤‡ä»½æ–‡ä»¶æˆ–è€…æ·»åŠ è¾…åŠ©namenode</li></ul></li><li>å—ç¼“å­˜ï¼šä¸€èˆ¬ä¸€ä¸ªå—ä»…åœ¨ä¸€ä¸ªdatanodeä¸­æœ‰å—ç¼“å­˜</li><li>è”é‚¦HDFSï¼šåœ¨æ•°æ®è§„æ¨¡å¤ªå¤§æ—¶ï¼Œå†…å­˜ä¼šæˆä¸ºç“¶é¢ˆâ€”â€”å…è®¸å¤šä¸ªnamenode</li><li>é«˜å¯ç”¨æ€§</li></ul><div class="note note-primary">            <p>ğŸ’¡ åŒºåˆ†é«˜å¯ç”¨æ€§å’Œå¤‡ä»½ï¼šé«˜å¯ç”¨æ€§éœ€è¦åœ¨åŸæœ‰çš„downä¹‹ååœ¨ä¸å¯è¢«ç”¨æˆ·æ„ŸçŸ¥çš„æ—¶é—´å†…æœ‰æ–°çš„ä¸»æœºä¸Šçº¿</p><p><strong>Hadoop2 ç»´æŠ¤é«˜å¯ç”¨çš„æ–¹å¼</strong><br>æœ‰ä¸€å¯¹namenodeså¤„äºä¸»å¤‡é…ç½®ã€‚å¦‚æœæ´»åŠ¨namenodeæ•…éšœï¼Œå¤‡ç”¨namenodeå°†æ¥ç®¡å…¶èŒè´£ï¼Œä»¥ç»§ç»­ä¸ºå®¢æˆ·ç«¯è¯·æ±‚æä¾›æœåŠ¡è€Œä¸ä¼šå‡ºç°é‡å¤§ä¸­æ–­ã€‚éœ€è¦è¿›è¡Œä¸€äº›ä½“ç³»ç»“æ„æ›´æ”¹æ‰èƒ½å®ç°è¿™ä¸€ç‚¹ï¼š</p><ol><li>namenodeså¿…é¡»ä½¿ç”¨é«˜å¯ç”¨å…±äº«å­˜å‚¨æ¥å…±äº«ç¼–è¾‘æ—¥å¿—ã€‚å½“å¤‡ç”¨namenodeå¯åŠ¨æ—¶ï¼Œå®ƒå°†è¯»å–å…±äº«ç¼–è¾‘æ—¥å¿—çš„æœ«å°¾ä»¥å°†å…¶çŠ¶æ€ä¸æ´»åŠ¨namenodeåŒæ­¥ï¼Œç„¶åç»§ç»­è¯»å–ç”±æ´»åŠ¨namenodeç¼–å†™çš„æ–°æ¡ç›®ã€‚</li><li>ç”±äºå—æ˜ å°„å­˜å‚¨åœ¨namenodeçš„å†…å­˜ä¸­è€Œä¸æ˜¯ç£ç›˜ä¸Šï¼Œå› æ­¤datanodeså¿…é¡»å‘ä¸¤ä¸ªnamenodeså‘é€å—æŠ¥å‘Šã€‚</li><li>å®¢æˆ·ç«¯å¿…é¡»é…ç½®ä»¥å¤„ç†namenodeæ•…éšœè½¬ç§»ï¼Œä½¿ç”¨å¯¹ç”¨æˆ·é€æ˜çš„æœºåˆ¶ã€‚</li><li>å¤‡ç”¨namenodeçš„è§’è‰²è¢«ä¸»å¤‡namenodesä»£æ›¿ï¼Œåè€…å¯¹æ´»åŠ¨namenodeçš„åç§°ç©ºé—´è¿›è¡Œå®šæœŸæ£€æŸ¥ç‚¹ã€‚</li></ol><p>Hadoop çš„é«˜å¯ç”¨åŒæ—¶ä¹Ÿæ˜¯ä½¿ç”¨äº† Zookeeper çš„ï¼Œåœ¨é»˜è®¤çš„æƒ…å†µä¸‹æ˜¯ç”¨ Zookeeper+å¿ƒè·³ç›‘è§†æ¥å®ç°æ•…éšœè½¬ç§»</p>          </div><h2 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h2><p>HTTPæ¯”åŸç”Ÿçš„è¦æ…¢ï¼Œä¸è¦ç”¨ä»–ä¼ è¾“å¤§æ–‡ä»¶ï¼ˆå°±æ˜¯ç”¨ <code>hdfs://</code> è¿™ç§è®¿é—®æ¥ä¼ è¾“æ–‡ä»¶ï¼‰</p><h3 id="åŸºäº-Java-çš„è¯»å†™"><a href="#åŸºäº-Java-çš„è¯»å†™" class="headerlink" title="åŸºäº Java çš„è¯»å†™"></a>åŸºäº Java çš„è¯»å†™</h3><p><strong>è¯»ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">FileSystem</span> <span class="hljs-variable">fs</span> <span class="hljs-operator">=</span> FileSystem.get(URI.create(uri), conf);<br><span class="hljs-type">FSDataInputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>in = fs.open(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(uri));<br>in.seek(<span class="hljs-number">0</span>)<br><span class="hljs-comment">// FSDataInputStream extends InputStream</span><br><span class="hljs-comment">// Special Methods:</span><br><span class="hljs-comment">// void seek(long pos);</span><br><span class="hljs-comment">// long getPos();</span><br><span class="hljs-comment">// å®ç°éšæœºè®¿é—®å’Œå½“å‰ä½ç½®è·ç¦»åˆå§‹çš„åç§»é‡</span><br></code></pre></td></tr></table></figure><p><strong><strong>å†™ï¼š</strong></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">OutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span> fs.create(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Path</span>(dst), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Progressable</span>() &#123;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">progress</span><span class="hljs-params">()</span> &#123;<br>System.out.print(<span class="hljs-string">&quot;.&quot;</span>);<br>&#125;<br>&#125;);<br></code></pre></td></tr></table></figure><p>å¯ä»¥é‡è½½ <code>Progressable</code> æ¥å£å®ç°å†™å…¥è¿‡ç¨‹çš„ progress barï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>append(Path f)</code> å‡½æ•°å‘ä¸€ä¸ªæ–‡ä»¶çš„æœ€åæ¥è¿½åŠ </p><div class="note note-warning">            <p>ğŸ’¡ <code>create</code> å‡½æ•°å¯ä»¥åˆ›å»ºä¸å­˜åœ¨çš„çˆ¶æ–‡ä»¶å¤¹ï¼Œå°½ç®¡è¿™æ ·åšå¯èƒ½æœ‰æ—¶å¹¶ä¸å®‰å…¨ï¼Œæ˜¯é€’å½’åˆ›å»ºçš„<br><code>append</code> ç”±äºè°ƒç”¨äº† <code>create</code>ï¼Œå› æ­¤ä¹Ÿæ‹¥æœ‰è¿™æ ·çš„ç‰¹æ€§</p>          </div><p>æ­¤å¤–ï¼Œç”¨ <code>FileSystem</code> çš„ <code>mkdir</code> å¯ä»¥åˆ›å»ºç›®å½•ï¼Œå°½ç®¡é€šå¸¸æƒ…å†µä¸éœ€è¦è¿™æ ·åš</p><h3 id="æ–‡ä»¶ç³»ç»Ÿ"><a href="#æ–‡ä»¶ç³»ç»Ÿ" class="headerlink" title="æ–‡ä»¶ç³»ç»Ÿ"></a>æ–‡ä»¶ç³»ç»Ÿ</h3><p><code>FileStatus</code> ç±»ä¿å­˜äº†æ–‡ä»¶çš„ metadataï¼ŒåŒæ—¶ FS å¯ä»¥é€šè¿‡ listStatus å‡½æ•°æ¥åˆ—å‡ºç›®å½•ä¸­çš„æ‰€æœ‰å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// code example here to covert FileStatus to Path</span><br>FileStatus[] status = fs.listStatus(paths);<br>Path[] listedPaths = FileUtil.stat2Paths(status);<br></code></pre></td></tr></table></figure><p><code>globStatus</code> æ–¹æ³•ç”¨äºåŒ¹é…é€šé…ç¬¦ï¼Œå¤æ‚çš„åŸºäºæ­£åˆ™è¡¨è¾¾å¼çš„åŒ¹é…éœ€è¦å®ç° <code>PathFilter</code> æ¥å£</p><p><code>delete</code> æ¥åˆ é™¤æ•°æ®ï¼Œå¹¶å¯ä»¥å†³å®šæ˜¯å¦é€’å½’åˆ é™¤</p><h2 id="è¯»å†™æµç¨‹è§£æ"><a href="#è¯»å†™æµç¨‹è§£æ" class="headerlink" title="è¯»å†™æµç¨‹è§£æ"></a>è¯»å†™æµç¨‹è§£æ</h2><h3 id="è¯»æµç¨‹"><a href="#è¯»æµç¨‹" class="headerlink" title="è¯»æµç¨‹"></a>è¯»æµç¨‹</h3><p><img src="/2023/03/07/Hadoop-HDFS/read.jpeg" alt="HDFS read"></p><ul><li><code>open</code> æ‰“å¼€ä¸€ä¸ªè¦è¯»å–çš„æ–‡ä»¶ï¼Œåˆ›å»º InputStream<ul><li>è¿™ä¸ªè¿‡ç¨‹é€šè¿‡ FileSystem å‘ Namenode å‘é€ä¸€ä¸ªRPCå®ç°ï¼Œç”³è¯·æ–‡ä»¶èµ·å§‹å—çš„åœ°å€</li><li>å¯¹äºæ¯ä¸€ä¸ªå—è¯·æ±‚ï¼ŒNamenode ä¼šè¿”å›ä¸€ä¸ª block æ‰€åœ¨çš„ Datanode çš„åœ°å€</li><li>è¿™äº›åœ°å€æ˜¯æŒ‰ç…§ç½‘ç»œæ‹“æ‰‘çš„è¿œè¿‘é¡ºåºè¿”å›çš„</li></ul></li><li><code>read</code> å‡½æ•°è®© InputStream å»è¿›è¡Œè¯»æ“ä½œï¼ŒInputStream ä¼šæ‰¾åˆ°æœ€è¿‘çš„ Datanode è¯»å–ç¬¬ä¸€ä¸ªå—</li><li>åœ¨è¿™ä¸ªå—è¯»å–å®Œæ—¶ï¼ŒInputStreamå…³é—­å’Œè¿™ä¸ª Datanode çš„è¿æ¥ï¼Œå¹¶è½¬åˆ°ä¸‹ä¸€ä¸ªæœ€è¿‘çš„ Datanode ç»§ç»­è¯»å–<ul><li>FS å‘ Namenode è¯·æ±‚æ–‡ä»¶å—çš„åœ°å€æ˜¯ä¸€æ‰¹ä¸€æ‰¹çš„ï¼Œåœ¨è¿™ä¸€æ‰¹è¯»å®Œå‰ä¼šè¯·æ±‚åˆ°ä¸‹ä¸€æ‰¹çš„åœ°å€ï¼Œè¯»å–è¿‡ç¨‹æ˜¯è¿ç»­çš„</li><li>Namenode å‚¨å­˜æ–‡ä»¶å¿«çš„èµ·å§‹åœ°å€æ˜¯åœ¨å†…å­˜ä¸­çš„ï¼Œæ‰€ä»¥éå¸¸é«˜æ•ˆ</li></ul></li><li>è¯»å–å®Œæˆåå…³é—­è¿æ¥</li></ul><div class="note note-primary">            <p>ğŸ”´ å®¹é”™å’Œæ•…éšœå¤„ç†ï¼šå¦‚æœå‘ç°è¿æ¥å¤±è´¥æˆ–è€…è¯»å–çš„å—ä¸å®Œæ•´ï¼ŒFS ä¼šé€šçŸ¥ namenodeï¼Œä»¥åä¸ä»è¿™ä¸ª datanode ä¸­è¿›è¡Œè¯»å–ã€‚</p>          </div><h3 id="å†™æµç¨‹"><a href="#å†™æµç¨‹" class="headerlink" title="å†™æµç¨‹"></a>å†™æµç¨‹</h3><p><img src="/2023/03/07/Hadoop-HDFS/write.jpeg" alt="HDFS write"></p><ul><li>é¦–å…ˆç”¨ <code>create</code> æ–¹æ³•æ¥åˆ›å»ºæ–‡ä»¶ï¼Œç„¶ååŒæ ·ç”± FS å‘ Namenode å‘é€ä¸€ä¸ª RPC æ¥è¿›è¡Œ namenode å¤„æ–‡ä»¶è®°å½•çš„åˆ›å»º</li><li>Namenode ä¼šè¿›è¡Œä¹Ÿç³»åˆ—æ£€æŸ¥ç¡®ä¿åˆ›å»ºæ˜¯åˆæ³•ä¸”æœ‰æƒé™çš„ï¼Œç„¶åè¿”å›ç»™ FSï¼Œè¿™ä¸ªæ—¶å€™ FS ä¼šè¿”å›ç»™ client ä¸€ä¸ª OutputStreamã€‚OutputStream è´Ÿè´£è¿›è¡Œ Namenode å’Œ datanode çš„é€šä¿¡ã€‚</li><li>OutputStream å°†è¦å†™å…¥çš„ blocks æ”¾å…¥ä¸€ä¸ª data queueï¼Œç„¶åæ‰§è¡Œä¸€ä¸ªæµæ°´çº¿è¿‡ç¨‹<ul><li>OutStream å°† block å†™å…¥è¯·æ±‚åˆ°çš„æœ€è¿‘çš„ datanode</li><li>ç„¶ådatanodeå°†å…¶æµæ°´çº¿å†™åˆ° replica çš„ datanodeä¸­</li><li>ç„¶åå†æµæ°´çº¿è¿”å›</li><li>OutputStream è¿˜ç»´æŠ¤ä¸€ä¸ª ack queueï¼Œè®°å½•å®Œå…¨å†™å®Œçš„block</li></ul></li></ul><div class="note note-primary">            <p>ğŸ”´ æ•…éšœå®¹é”™å¤„ç†ï¼šå¦‚æœæœ‰ä¸€ä¸ªå†™å…¥æ•…éšœçš„æ•°æ®åŒ…ï¼Œç«‹åˆ»å…³æ‰æ•´ä¸ªpipelineï¼ŒæŠŠæ‰€æœ‰åœ¨pipeline ä¸­çš„æ•°æ®åŒ…è¿”å›åˆ°æ•°æ®é˜Ÿåˆ—çš„å‰ç«¯ï¼Œç„¶ååœ¨æ­£å¸¸çš„ datanode çš„ block åˆ¶å®šä¸€ä¸ªè¡¨ç¤ºï¼Œç„¶åä¼ é€’ç»™ namenodeã€‚ namenode æ„è¯†åˆ° repica ä¸è¶³æ—¶ï¼Œä¼šç»§ç»­åœ¨æ–°èŠ‚ç‚¹ä¸Šåˆ›å»ºå‰¯æœ¬</p>          </div><ul><li>æ•´ä¸ªåœ¨å†™å…¥å®Œæˆåè°ƒç”¨ close æ–¹æ³•</li></ul><h2 id="distcpå¤åˆ¶"><a href="#distcpå¤åˆ¶" class="headerlink" title="distcpå¤åˆ¶"></a>distcpå¤åˆ¶</h2><p>distcp å¯ä»¥æä¾› HDFS ä¹‹é—´çš„å¤§æ‰¹é‡å¤åˆ¶</p>]]></content>
    
    
    
    <tags>
      
      <tag>Hadoop</tag>
      
      <tag>å¼•æ“åŸºç¡€</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
